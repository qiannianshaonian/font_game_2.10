{
  "code": "import { Laya } from \"Laya\";\r\nimport { Browser } from \"laya/utils/Browser\";\r\nexport class WxMiniUtil {\r\n    static login(completeHandler) {\r\n        let sysInfo = Browser.window.wx.getSystemInfoSync();\r\n        let width = sysInfo.screenWidth;\r\n        let height = sysInfo.screenHeight;\r\n        Browser.window.wx.getSetting({\r\n            success(res) {\r\n                console.log(res.authSetting);\r\n                if (res.authSetting[\"scope.userInfo\"]) {\r\n                    console.log(\"用户已授权\");\r\n                    Browser.window.wx.getUserInfo({\r\n                        success(res) {\r\n                            console.log(res);\r\n                            completeHandler.runWith(true);\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    console.log(\"用户未授权\");\r\n                    let button = Browser.window.wx.createUserInfoButton({\r\n                        type: 'text',\r\n                        text: '',\r\n                        style: {\r\n                            left: 0,\r\n                            top: 0,\r\n                            width: width,\r\n                            height: height,\r\n                            backgroundColor: '#00000000',\r\n                            color: '#ffffff',\r\n                            fontSize: 20,\r\n                            textAlign: \"center\",\r\n                            lineHeight: height,\r\n                        }\r\n                    });\r\n                    button.onTap((res) => {\r\n                        if (res.userInfo) {\r\n                            console.log(\"用户授权:\", res);\r\n                            completeHandler.runWith(true);\r\n                            button.destroy();\r\n                        }\r\n                        else {\r\n                            console.log(\"用户拒绝授权:\", res);\r\n                            completeHandler.runWith(false);\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }\r\n    static update(hanlder) {\r\n        const updateManager = Browser.window.wx.getUpdateManager();\r\n        updateManager.onCheckForUpdate(function (res) {\r\n            console.log(\"新版本信息：\" + res.hasUpdate);\r\n        });\r\n        updateManager.onUpdateReady(function () {\r\n            Browser.window.wx.showModal({\r\n                title: '更新提示',\r\n                content: '新版本已经准备好，是否重启应用？',\r\n                success(res) {\r\n                    if (res.confirm) {\r\n                        updateManager.applyUpdate();\r\n                    }\r\n                }\r\n            });\r\n        });\r\n        updateManager.onUpdateFailed(function () {\r\n            console.log(\"新版本信息下载失败！！！！！\");\r\n        });\r\n    }\r\n    static getIsBangs(completeHandler) {\r\n        Browser.window.wx.getSystemInfo({\r\n            success: function (wxInfo) {\r\n                WxMiniUtil.wxinfo = wxInfo;\r\n                console.log('获取系统信息-----success:' + wxInfo);\r\n            },\r\n            fail: function (wxInfo) {\r\n                console.log('获取系统信息-----fail:' + wxInfo);\r\n            },\r\n            complete: function (wxInfo) {\r\n                console.log('获取系统信息-----complete:' + \"windowHeight：\" + wxInfo.windowHeight + \" windowWidth:\" + wxInfo.windowWidth);\r\n                let isBang = wxInfo.windowHeight / wxInfo.windowWidth > Laya.stage.designHeight / Laya.stage.designWidth ? \"true\" : \"false\";\r\n                completeHandler.runWith(isBang);\r\n            }\r\n        });\r\n    }\r\n    static shareWebPage(complete) {\r\n        WxMiniUtil.shareWebHandler = complete;\r\n        if (Browser.window.tt) {\r\n            Browser.window.tt.shareAppMessage({\r\n                title: '趣味汉字',\r\n                desc: \"#趣味汉字 #抖音小游戏\",\r\n                imageUrl: \"miniImg/miniShare.png\",\r\n                success() {\r\n                    console.log(\"分享成功\");\r\n                    WxMiniUtil.shareWebHandler.runWith(\"true\");\r\n                },\r\n                fail(e) {\r\n                    console.log(\"分享失败\");\r\n                    WxMiniUtil.shareWebHandler.runWith(\"false\");\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            Browser.window.wx.shareAppMessage({\r\n                title: '趣味汉字',\r\n                desc: \"趣味汉字等你来战\",\r\n                imageUrl: 'miniImg/miniShare.png'\r\n            });\r\n        }\r\n    }\r\n    static onShareAppMessage() {\r\n        Browser.window.wx.onShareAppMessage(function () {\r\n            return {\r\n                title: '趣味汉字',\r\n                biliContent: \"#趣味汉字#\",\r\n                imageUrl: 'miniImg/miniShare.png'\r\n            };\r\n        });\r\n    }\r\n    static showBanner() {\r\n        if (!Browser.onTTMiniGame) {\r\n            return;\r\n        }\r\n        WxMiniUtil.bannerVisible = true;\r\n        let sysInfo = Browser.window.wx.getSystemInfoSync();\r\n        let bannerWidth = sysInfo.screenWidth;\r\n        let bannerHeight = sysInfo.screenHeight;\r\n        if (WxMiniUtil.bannerAd) {\r\n            WxMiniUtil.bannerAd.destroy();\r\n            WxMiniUtil.bannerAd = null;\r\n        }\r\n        let adID = Browser.window.tt ? \"f7iibhjbf251ui7u79\" : \"adunit-3bf2554b5207e425\";\r\n        WxMiniUtil.bannerAd = Browser.window.tt.createBannerAd({\r\n            adUnitId: adID,\r\n            style: {\r\n                left: (bannerWidth - bannerWidth * 95 / 100) / 2,\r\n                top: bannerHeight - 120,\r\n                width: bannerWidth * 95 / 100\r\n            }\r\n        });\r\n        WxMiniUtil.bannerAd.onLoad(function () {\r\n            if (WxMiniUtil.bannerVisible) {\r\n                WxMiniUtil.bannerAd.show()\r\n                    .then(() => {\r\n                    console.log(\"广告显示成功\");\r\n                })\r\n                    .catch(err => {\r\n                    console.log(\"广告组件出现问题\", err);\r\n                });\r\n            }\r\n        });\r\n        WxMiniUtil.bannerAd.onError(err => {\r\n            console.log(err);\r\n        });\r\n        WxMiniUtil.bannerAd.onResize(res => {\r\n            WxMiniUtil.bannerAd.style.top = bannerHeight - res.height;\r\n            WxMiniUtil.bannerAd.style.left = (bannerWidth - res.width) / 2;\r\n        });\r\n    }\r\n    static hideBanner() {\r\n        if (!Browser.onTTMiniGame) {\r\n            return;\r\n        }\r\n        WxMiniUtil.bannerVisible = false;\r\n        if (WxMiniUtil.bannerAd) {\r\n            WxMiniUtil.bannerAd.destroy();\r\n            WxMiniUtil.bannerAd = null;\r\n        }\r\n    }\r\n    static loadRewardedVideo(completeHandler) {\r\n        WxMiniUtil.loadVideoComplete = completeHandler;\r\n        if (!WxMiniUtil.rewardedvideo) {\r\n            WxMiniUtil.rewardedvideo = Browser.window.tt.createRewardedVideoAd({ adUnitId: 'adunit-a7bced9f18d8a7bb' });\r\n            WxMiniUtil.rewardedvideo.onLoad(() => {\r\n                console.log('激励视频 广告加载成功');\r\n                WxMiniUtil.loadVideoComplete.runWith(\"true\");\r\n            });\r\n            WxMiniUtil.rewardedvideo.onError(err => {\r\n                console.log(err);\r\n            });\r\n        }\r\n        else {\r\n            WxMiniUtil.rewardedvideo.load();\r\n        }\r\n    }\r\n    static showRewardedVideo(completeHandler) {\r\n        if (!Browser.onTTMiniGame) {\r\n            completeHandler.run();\r\n            return;\r\n        }\r\n        WxMiniUtil.showAdVideoHandler = completeHandler;\r\n        if (!WxMiniUtil.rewardedvideo) {\r\n            let adID = \"1j4221j5gf9jd1gllf\";\r\n            WxMiniUtil.rewardedvideo = Browser.window.tt.createRewardedVideoAd({ adUnitId: adID });\r\n            WxMiniUtil.rewardedvideo.onClose(res => {\r\n                if (res && res.isEnded || res === undefined) {\r\n                    console.log(\"激励视频播放完成\");\r\n                    WxMiniUtil.showAdVideoHandler.runWith(\"true\");\r\n                }\r\n                else {\r\n                }\r\n            });\r\n            WxMiniUtil.rewardedvideo.onError(err => {\r\n                console.log(err);\r\n            });\r\n        }\r\n        WxMiniUtil.rewardedvideo.show()\r\n            .catch(err => {\r\n            WxMiniUtil.rewardedvideo.load()\r\n                .then(() => {\r\n                WxMiniUtil.rewardedvideo.show();\r\n            });\r\n            console.log(\"show激励视频\" + err);\r\n        });\r\n    }\r\n    static showInterstitialAd(completeHandler = null) {\r\n        if (!Browser.onTTMiniGame) {\r\n            WxMiniUtil.interstitialAdHandler.runWith(\"false1\");\r\n            return;\r\n        }\r\n        WxMiniUtil.interstitialAdHandler = completeHandler;\r\n        if (Browser.window.tt) {\r\n            const isToutiaio = Browser.window.tt.getSystemInfoSync().appName === \"Douyin\";\r\n            if (!isToutiaio) {\r\n                WxMiniUtil.interstitialAdHandler.runWith(\"false2\");\r\n                return;\r\n            }\r\n        }\r\n        let adID = \"1b2m7lpbgi51jajhce\";\r\n        WxMiniUtil.interstitialAd = Browser.window.tt.createInterstitialAd({ adUnitId: adID });\r\n        WxMiniUtil.interstitialAd.onClose(res => {\r\n            let titlestr = \"触发*万能字技能\";\r\n            let flag = \"true1\";\r\n            if (Math.floor(Math.random() * 100) < 50) {\r\n                titlestr = \"触发仙人指路技能\";\r\n                flag = \"true2\";\r\n            }\r\n            Browser.window.tt.showToast({\r\n                title: titlestr,\r\n                duration: 2500,\r\n                success(res) {\r\n                    console.log(`${res}`);\r\n                },\r\n                fail(res) {\r\n                    console.log(`showToast 调用失败`);\r\n                },\r\n            });\r\n            WxMiniUtil.interstitialAd.destroy();\r\n            if (WxMiniUtil.interstitialAdHandler)\r\n                WxMiniUtil.interstitialAdHandler.runWith(flag);\r\n        });\r\n        WxMiniUtil.interstitialAd.onError(err => {\r\n            WxMiniUtil.interstitialAdHandler.runWith(\"false3\");\r\n        });\r\n        WxMiniUtil.interstitialAd.load()\r\n            .then(() => WxMiniUtil.interstitialAd.show()).catch(err => {\r\n            WxMiniUtil.interstitialAdHandler.runWith(\"false4\");\r\n        });\r\n    }\r\n    static showGameIconAd() {\r\n        if (!Browser.window.wx)\r\n            return;\r\n        var count = 5;\r\n        if (!WxMiniUtil.cconAdobjArr) {\r\n            WxMiniUtil.cconAdobjArr = [];\r\n            for (let index = 0; index < count; index++) {\r\n                var obj = {};\r\n                obj.appNameHidden = false;\r\n                obj.color = \"#ffffff\";\r\n                obj.top = WxMiniUtil.wxinfo.screenHeight / 2 - 15;\r\n                WxMiniUtil.cconAdobjArr.push(obj);\r\n            }\r\n        }\r\n        if (!WxMiniUtil.iconAd && Browser.window.wx.createGameIcon) {\r\n            WxMiniUtil.iconAd = Browser.window.wx.createGameIcon({\r\n                adUnitId: 'PBgAAfCNfP3TjmkM',\r\n                count: 5,\r\n                style: WxMiniUtil.cconAdobjArr\r\n            });\r\n        }\r\n        if (WxMiniUtil.iconAd) {\r\n            WxMiniUtil.iconAd.load().then(() => {\r\n                WxMiniUtil.iconAd.show();\r\n            }).catch((err) => {\r\n                console.error(err);\r\n                console.log(\"showGameIconAd Error:\" + err);\r\n            });\r\n        }\r\n    }\r\n    static showGamePortal() {\r\n        if (Browser.window.wx.createGamePortal) {\r\n            WxMiniUtil.portalAd = Browser.window.wx.createGamePortal({\r\n                adUnitId: 'PBgAAet6sZW2CQug'\r\n            });\r\n        }\r\n        if (WxMiniUtil.portalAd) {\r\n            WxMiniUtil.portalAd.load().then(() => {\r\n                WxMiniUtil.portalAd.show();\r\n            }).catch((err) => {\r\n                if (err.errCode == 1004) {\r\n                }\r\n                console.error(err);\r\n            });\r\n        }\r\n    }\r\n}\r\nWxMiniUtil.bannerVisible = false;\r\nWxMiniUtil.cconAdobjArr = [];\r\nWxMiniUtil.portalAd = null;\r\n",
  "references": [
    "/Users/zonst/Documents/font_vivo/font_game_2.10/libs/Laya.ts",
    "/Users/zonst/Documents/font_vivo/font_game_2.10/libs/laya/net/TTFLoader.ts",
    "/Users/zonst/Documents/font_vivo/font_game_2.10/libs/laya/utils/Browser.ts",
    "/Users/zonst/Documents/font_vivo/font_game_2.10/libs/laya/utils/Handler.ts"
  ]
}

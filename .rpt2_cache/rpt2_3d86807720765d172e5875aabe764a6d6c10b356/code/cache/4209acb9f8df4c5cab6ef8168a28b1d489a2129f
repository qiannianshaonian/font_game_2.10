{
  "code": "import { Filter } from \"./Filter\";\r\nimport { ColorUtils } from \"../utils/ColorUtils\";\r\nexport class ColorFilter extends Filter {\r\n    constructor(mat = null) {\r\n        super();\r\n        if (!mat)\r\n            mat = this._copyMatrix(ColorFilter.IDENTITY_MATRIX);\r\n        this._mat = new Float32Array(16);\r\n        this._alpha = new Float32Array(4);\r\n        this.setByMatrix(mat);\r\n    }\r\n    gray() {\r\n        return this.setByMatrix(ColorFilter.GRAY_MATRIX);\r\n    }\r\n    color(red = 0, green = 0, blue = 0, alpha = 1) {\r\n        return this.setByMatrix([1, 0, 0, 0, red, 0, 1, 0, 0, green, 0, 0, 1, 0, blue, 0, 0, 0, 1, alpha]);\r\n    }\r\n    setColor(color) {\r\n        var arr = ColorUtils.create(color).arrColor;\r\n        var mt = [0, 0, 0, 0, 256 * arr[0], 0, 0, 0, 0, 256 * arr[1], 0, 0, 0, 0, 256 * arr[2], 0, 0, 0, 1, 0];\r\n        return this.setByMatrix(mt);\r\n    }\r\n    setByMatrix(matrix) {\r\n        if (this._matrix != matrix)\r\n            this._copyMatrix(matrix);\r\n        var j = 0;\r\n        var z = 0;\r\n        for (var i = 0; i < 20; i++) {\r\n            if (i % 5 != 4) {\r\n                this._mat[j++] = matrix[i];\r\n            }\r\n            else {\r\n                this._alpha[z++] = matrix[i];\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    get type() {\r\n        return Filter.COLOR;\r\n    }\r\n    adjustColor(brightness, contrast, saturation, hue) {\r\n        this.adjustHue(hue);\r\n        this.adjustContrast(contrast);\r\n        this.adjustBrightness(brightness);\r\n        this.adjustSaturation(saturation);\r\n        return this;\r\n    }\r\n    adjustBrightness(brightness) {\r\n        brightness = this._clampValue(brightness, 100);\r\n        if (brightness == 0 || isNaN(brightness))\r\n            return this;\r\n        return this._multiplyMatrix([1, 0, 0, 0, brightness, 0, 1, 0, 0, brightness, 0, 0, 1, 0, brightness, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]);\r\n    }\r\n    adjustContrast(contrast) {\r\n        contrast = this._clampValue(contrast, 100);\r\n        if (contrast == 0 || isNaN(contrast))\r\n            return this;\r\n        var x;\r\n        if (contrast < 0) {\r\n            x = 127 + contrast / 100 * 127;\r\n        }\r\n        else {\r\n            x = contrast % 1;\r\n            if (x == 0) {\r\n                x = ColorFilter.DELTA_INDEX[contrast];\r\n            }\r\n            else {\r\n                x = ColorFilter.DELTA_INDEX[(contrast << 0)] * (1 - x) + ColorFilter.DELTA_INDEX[(contrast << 0) + 1] * x;\r\n            }\r\n            x = x * 127 + 127;\r\n        }\r\n        var x1 = x / 127;\r\n        var x2 = (127 - x) * 0.5;\r\n        return this._multiplyMatrix([x1, 0, 0, 0, x2, 0, x1, 0, 0, x2, 0, 0, x1, 0, x2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]);\r\n    }\r\n    adjustSaturation(saturation) {\r\n        saturation = this._clampValue(saturation, 100);\r\n        if (saturation == 0 || isNaN(saturation))\r\n            return this;\r\n        var x = 1 + ((saturation > 0) ? 3 * saturation / 100 : saturation / 100);\r\n        var dx = 1 - x;\r\n        var r = 0.3086 * dx;\r\n        var g = 0.6094 * dx;\r\n        var b = 0.0820 * dx;\r\n        return this._multiplyMatrix([r + x, g, b, 0, 0, r, g + x, b, 0, 0, r, g, b + x, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]);\r\n    }\r\n    adjustHue(hue) {\r\n        hue = this._clampValue(hue, 180) / 180 * Math.PI;\r\n        if (hue == 0 || isNaN(hue))\r\n            return this;\r\n        var cos = Math.cos(hue);\r\n        var sin = Math.sin(hue);\r\n        var r = 0.213;\r\n        var g = 0.715;\r\n        var b = 0.072;\r\n        return this._multiplyMatrix([r + cos * (1 - r) + sin * (-r), g + cos * (-g) + sin * (-g), b + cos * (-b) + sin * (1 - b), 0, 0, r + cos * (-r) + sin * (0.143), g + cos * (1 - g) + sin * (0.140), b + cos * (-b) + sin * (-0.283), 0, 0, r + cos * (-r) + sin * (-(1 - r)), g + cos * (-g) + sin * (g), b + cos * (1 - b) + sin * (b), 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]);\r\n    }\r\n    reset() {\r\n        return this.setByMatrix(this._copyMatrix(ColorFilter.IDENTITY_MATRIX));\r\n    }\r\n    _multiplyMatrix(matrix) {\r\n        var col = [];\r\n        this._matrix = this._fixMatrix(this._matrix);\r\n        for (var i = 0; i < 5; i++) {\r\n            for (var j = 0; j < 5; j++) {\r\n                col[j] = this._matrix[j + i * 5];\r\n            }\r\n            for (j = 0; j < 5; j++) {\r\n                var val = 0;\r\n                for (var k = 0; k < 5; k++) {\r\n                    val += matrix[j + k * 5] * col[k];\r\n                }\r\n                this._matrix[j + i * 5] = val;\r\n            }\r\n        }\r\n        return this.setByMatrix(this._matrix);\r\n    }\r\n    _clampValue(val, limit) {\r\n        return Math.min(limit, Math.max(-limit, val));\r\n    }\r\n    _fixMatrix(matrix = null) {\r\n        if (matrix == null)\r\n            return ColorFilter.IDENTITY_MATRIX;\r\n        if (matrix.length < ColorFilter.LENGTH)\r\n            matrix = matrix.slice(0, matrix.length).concat(ColorFilter.IDENTITY_MATRIX.slice(matrix.length, ColorFilter.LENGTH));\r\n        else if (matrix.length > ColorFilter.LENGTH)\r\n            matrix = matrix.slice(0, ColorFilter.LENGTH);\r\n        return matrix;\r\n    }\r\n    _copyMatrix(matrix) {\r\n        var len = ColorFilter.LENGTH;\r\n        if (!this._matrix)\r\n            this._matrix = [];\r\n        for (var i = 0; i < len; i++) {\r\n            this._matrix[i] = matrix[i];\r\n        }\r\n        return this._matrix;\r\n    }\r\n}\r\nColorFilter.DELTA_INDEX = [0, 0.01, 0.02, 0.04, 0.05, 0.06, 0.07, 0.08, 0.1, 0.11, 0.12, 0.14, 0.15, 0.16, 0.17, 0.18, 0.20, 0.21, 0.22, 0.24, 0.25, 0.27, 0.28, 0.30, 0.32, 0.34, 0.36, 0.38, 0.40, 0.42, 0.44, 0.46, 0.48, 0.5, 0.53, 0.56, 0.59, 0.62, 0.65, 0.68, 0.71, 0.74, 0.77, 0.80, 0.83, 0.86, 0.89, 0.92, 0.95, 0.98, 1.0, 1.06, 1.12, 1.18, 1.24, 1.30, 1.36, 1.42, 1.48, 1.54, 1.60, 1.66, 1.72, 1.78, 1.84, 1.90, 1.96, 2.0, 2.12, 2.25, 2.37, 2.50, 2.62, 2.75, 2.87, 3.0, 3.2, 3.4, 3.6, 3.8, 4.0, 4.3, 4.7, 4.9, 5.0, 5.5, 6.0, 6.5, 6.8, 7.0, 7.3, 7.5, 7.8, 8.0, 8.4, 8.7, 9.0, 9.4, 9.6, 9.8, 10.0];\r\nColorFilter.GRAY_MATRIX = [0.3086, 0.6094, 0.082, 0, 0, 0.3086, 0.6094, 0.082, 0, 0, 0.3086, 0.6094, 0.082, 0, 0, 0, 0, 0, 1, 0];\r\nColorFilter.IDENTITY_MATRIX = [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1];\r\nColorFilter.LENGTH = 25;\r\n",
  "references": [
    "/Users/zonst/Documents/font_vivo/font_game_2.10/libs/laya/filters/Filter.ts",
    "/Users/zonst/Documents/font_vivo/font_game_2.10/libs/laya/filters/IFilter.ts",
    "/Users/zonst/Documents/font_vivo/font_game_2.10/libs/laya/utils/ColorUtils.ts"
  ],
  "dts": {
    "name": "/Users/zonst/Documents/font_vivo/font_game_2.10/libs/laya/filters/ColorFilter.d.ts",
    "writeByteOrderMark": false,
    "text": "import { Filter } from \"./Filter\";\r\nimport { IFilter } from \"./IFilter\";\r\nexport declare class ColorFilter extends Filter implements IFilter {\r\n    private static DELTA_INDEX;\r\n    private static GRAY_MATRIX;\r\n    private static IDENTITY_MATRIX;\r\n    private static LENGTH;\r\n    _mat: Float32Array;\r\n    _alpha: Float32Array;\r\n    private _matrix;\r\n    constructor(mat?: any[]);\r\n    gray(): ColorFilter;\r\n    color(red?: number, green?: number, blue?: number, alpha?: number): ColorFilter;\r\n    setColor(color: string): ColorFilter;\r\n    setByMatrix(matrix: any[]): ColorFilter;\r\n    readonly type: number;\r\n    adjustColor(brightness: number, contrast: number, saturation: number, hue: number): ColorFilter;\r\n    adjustBrightness(brightness: number): ColorFilter;\r\n    adjustContrast(contrast: number): ColorFilter;\r\n    adjustSaturation(saturation: number): ColorFilter;\r\n    adjustHue(hue: number): ColorFilter;\r\n    reset(): ColorFilter;\r\n    private _multiplyMatrix;\r\n    private _clampValue;\r\n    private _fixMatrix;\r\n    private _copyMatrix;\r\n}\r\n"
  }
}

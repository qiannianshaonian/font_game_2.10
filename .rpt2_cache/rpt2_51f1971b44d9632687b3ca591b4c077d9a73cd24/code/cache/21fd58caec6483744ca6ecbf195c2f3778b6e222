{
  "code": "import PrefebBase from \"./PrefebBase\";\r\nimport AppConfig from \"../../AppConfig\";\r\nimport ControllerMgr from \"../controller/ControllerMgr\";\r\nimport TipController from \"../controller/TipController\";\r\nimport SoundTool from \"../tool/SoundTool\";\r\nimport { Browser } from \"laya/utils/Browser\";\r\nimport { Handler } from \"laya/utils/Handler\";\r\nimport { Event } from \"laya/events/Event\";\r\nimport { Laya } from \"Laya\";\r\nimport { Point } from \"laya/maths/Point\";\r\nimport { WxMiniUtil } from \"../tool/WxMiniUtil\";\r\nimport { TTMiniUtils } from \"../tool/TTMiniUtil\";\r\nexport default class GameSetting extends PrefebBase {\r\n    constructor() { super(); }\r\n    onAwake() {\r\n        super.onAwake();\r\n        this.btn_home.clickHandler = Handler.create(this, function () {\r\n            this.showHomeHandler.run();\r\n        }, null, false);\r\n        this.btn_tryAgain.clickHandler = Handler.create(this, function () {\r\n            if (AppConfig.platform == \"wx\") {\r\n                this.restartHandler.runWith(1);\r\n                Browser.window.wx[\"shareAppMessage\"]({\r\n                    title: '发现有个有趣的游戏',\r\n                    imageUrl: \"https://mmocgame.qpic.cn/wechatgame/iaUVuxArE9L9G28F6XrxKAIEtJOs9x1Ycm2MYmC2Uz5T9O4RLq0ejvG3ic2KlUBiaVf/0\",\r\n                    imageUrlId: \"NelenHPLRXK1-AWENn0aZw\"\r\n                });\r\n            }\r\n            else {\r\n                this.restartHandler.run();\r\n            }\r\n        }, null, false);\r\n        this.btn_share.clickHandler = (Handler.create(this, function (e) {\r\n            if (AppConfig.platform == \"wx\") {\r\n                Browser.window.wx[\"shareAppMessage\"]({\r\n                    title: '发现有个有趣的游戏',\r\n                    imageUrl: \"https://mmocgame.qpic.cn/wechatgame/iaUVuxArE9L9G28F6XrxKAIEtJOs9x1Ycm2MYmC2Uz5T9O4RLq0ejvG3ic2KlUBiaVf/0\",\r\n                    imageUrlId: \"NelenHPLRXK1-AWENn0aZw\"\r\n                });\r\n            }\r\n            else if (AppConfig.platform == \"tt\") {\r\n                TTMiniUtils.stopGameRecorder();\r\n                TTMiniUtils.shareGameRecorder(Handler.create(this, this.onShareGameRecordComple));\r\n            }\r\n            else {\r\n                ControllerMgr.getInstance(TipController).showTip(\"尽情期待\");\r\n            }\r\n        }, null, false));\r\n        this.btn_close.clickHandler = (Handler.create(this, function (e) {\r\n            this.onCloseHandler.run();\r\n        }, null, false));\r\n        this.btn_music.on(Event.MOUSE_DOWN, this, this.onDragMouseDown);\r\n        this.btn_effect.on(Event.MOUSE_DOWN, this, this.onDragMouseDown);\r\n        this.refresh();\r\n    }\r\n    onDragMouseDown(e) {\r\n        this._dragTarget = e.currentTarget;\r\n        Laya.stage.on(Event.MOUSE_UP, this, this.onStageMouseUp2);\r\n        Laya.stage.on(Event.MOUSE_MOVE, this, this.onStageMouseMove2);\r\n    }\r\n    onStageMouseUp2(e) {\r\n        this._dragTarget = null;\r\n        Laya.stage.off(Event.MOUSE_UP, this, this.onStageMouseUp2);\r\n        Laya.stage.off(Event.MOUSE_MOVE, this, this.onStageMouseMove2);\r\n    }\r\n    onStageMouseMove2(e) {\r\n        let point = new Point(e.stageX, e.stageY);\r\n        let progress;\r\n        if (this._dragTarget == this.btn_effect) {\r\n            progress = this.progress_effect;\r\n        }\r\n        point = this._dragTarget.parent[\"globalToLocal\"](point);\r\n        let x = point.x - progress.x;\r\n        if (x < 0) {\r\n            x = 0;\r\n        }\r\n        else if (x > 346) {\r\n            x = 346;\r\n        }\r\n        progress.width = x;\r\n        let num = x / 346;\r\n        progress.width = num;\r\n        if (progress == this.progress_effect) {\r\n            SoundTool.setSoundVolume(num);\r\n        }\r\n        this.refresh();\r\n    }\r\n    refresh() {\r\n        this.progress_effect.width = 346 * SoundTool.getSoundVolume();\r\n        this.btn_effect.x = this.progress_effect.x + this.progress_effect.width;\r\n    }\r\n    onEnable() {\r\n        WxMiniUtil.showBanner();\r\n    }\r\n    onDisable() {\r\n        this.btn_home.offAll();\r\n        this.btn_tryAgain.offAll();\r\n        this.btn_share.offAll();\r\n        WxMiniUtil.hideBanner();\r\n    }\r\n    onShareGameRecordComple(data) {\r\n        if (data != \"true\") {\r\n            ControllerMgr.getInstance(TipController).showCenterBottomTip(\"录屏时长不足3秒,请重新录制\");\r\n        }\r\n        console.log(\"...分享了完成了\", data);\r\n        if (AppConfig.platform == \"tt\") {\r\n            Laya.timer.once(500, this, function () {\r\n                TTMiniUtils.startGameRecorder();\r\n            });\r\n        }\r\n    }\r\n}\r\n",
  "references": [
    "/Users/zonst/Documents/font2.0/font_game_2.10/src/script/prefeb/PrefebBase.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/src/AppConfig.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/src/script/controller/ControllerMgr.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/src/script/controller/TipController.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/src/script/tool/SoundTool.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/utils/Browser.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/utils/Handler.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/ui/Button.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/events/Event.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/Laya.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/maths/Point.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/ui/Image.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/src/script/tool/WxMiniUtil.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/src/script/tool/TTMiniUtil.ts"
  ]
}

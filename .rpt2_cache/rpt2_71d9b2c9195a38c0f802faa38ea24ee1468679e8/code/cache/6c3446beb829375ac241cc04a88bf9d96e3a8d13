{
  "code": "import { Graphics } from \"../display/Graphics\";\r\nimport { Texture } from \"../resource/Texture\";\r\nimport { Utils } from \"../utils/Utils\";\r\nimport { ClassUtils } from \"../utils/ClassUtils\";\r\nimport { ILaya } from \"../../ILaya\";\r\nimport { Draw9GridTexture } from \"../display/cmd/Draw9GridTexture\";\r\nimport { DrawTextureCmd } from \"../display/cmd/DrawTextureCmd\";\r\nimport { SpriteConst } from \"../display/SpriteConst\";\r\nexport class AutoBitmap extends Graphics {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.autoCacheCmd = true;\r\n        this._width = 0;\r\n        this._height = 0;\r\n        this.uv = null;\r\n    }\r\n    destroy() {\r\n        super.destroy();\r\n        this._source = null;\r\n        this._sizeGrid = null;\r\n        this._offset = null;\r\n    }\r\n    get sizeGrid() {\r\n        return this._sizeGrid;\r\n    }\r\n    set sizeGrid(value) {\r\n        this._sizeGrid = value.map((v) => { return +v; });\r\n        this._setChanged();\r\n    }\r\n    get width() {\r\n        if (this._width)\r\n            return this._width;\r\n        if (this._source)\r\n            return this._source.sourceWidth;\r\n        return 0;\r\n    }\r\n    set width(value) {\r\n        if (this._width != value) {\r\n            this._width = value;\r\n            this._setChanged();\r\n        }\r\n    }\r\n    get height() {\r\n        if (this._height)\r\n            return this._height;\r\n        if (this._source)\r\n            return this._source.sourceHeight;\r\n        return 0;\r\n    }\r\n    set height(value) {\r\n        if (this._height != value) {\r\n            this._height = value;\r\n            this._setChanged();\r\n        }\r\n    }\r\n    get source() {\r\n        return this._source;\r\n    }\r\n    set source(value) {\r\n        if (value) {\r\n            this._source = value;\r\n            this._setChanged();\r\n        }\r\n        else {\r\n            this._source = null;\r\n            if (this._drawGridCmd) {\r\n                if (this._one) {\r\n                    if (this._one == this._drawGridCmd) {\r\n                        this.clear();\r\n                    }\r\n                }\r\n                let cmds = this.cmds;\r\n                if (cmds && cmds.length > 0) {\r\n                    if (cmds[0] == this._drawGridCmd) {\r\n                        cmds.splice(0, 1);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _setChanged() {\r\n        if (!this._isChanged) {\r\n            this._isChanged = true;\r\n            ILaya.timer.callLater(this, this.changeSource);\r\n        }\r\n    }\r\n    _createDrawTexture(texture, x = 0, y = 0, width = 0, height = 0, matrix = null, alpha = 1, color = null, blendMode = null, uv) {\r\n        if (!texture || alpha < 0.01)\r\n            return null;\r\n        if (!texture.getIsReady())\r\n            return null;\r\n        if (!width)\r\n            width = texture.sourceWidth;\r\n        if (!height)\r\n            height = texture.sourceHeight;\r\n        if (texture.getIsReady()) {\r\n            var wRate = width / texture.sourceWidth;\r\n            var hRate = height / texture.sourceHeight;\r\n            width = texture.width * wRate;\r\n            height = texture.height * hRate;\r\n            if (width <= 0 || height <= 0)\r\n                return null;\r\n            x += texture.offsetX * wRate;\r\n            y += texture.offsetY * hRate;\r\n        }\r\n        if (this._sp) {\r\n            this._sp._renderType |= SpriteConst.GRAPHICS;\r\n            this._sp._setRenderType(this._sp._renderType);\r\n        }\r\n        return DrawTextureCmd.create.call(this, texture, x, y, width, height, matrix, alpha, color, blendMode, uv);\r\n    }\r\n    changeSource() {\r\n        this._isChanged = false;\r\n        var source = this._source;\r\n        if (!source || !source.bitmap)\r\n            return;\r\n        var width = this.width;\r\n        var height = this.height;\r\n        var sizeGrid = this._sizeGrid;\r\n        var sw = source.sourceWidth;\r\n        var sh = source.sourceHeight;\r\n        if (!sizeGrid || (sw === width && sh === height)) {\r\n            let cmd = this._createDrawTexture(source, this._offset ? this._offset[0] : 0, this._offset ? this._offset[1] : 0, width, height, null, 1, null, null, this.uv);\r\n            cmd && this._setDrawGridCmd(cmd);\r\n        }\r\n        else {\r\n            let cmd = Draw9GridTexture.create(source, 0, 0, width, height, sizeGrid);\r\n            this._setDrawGridCmd(cmd);\r\n        }\r\n        this._repaint();\r\n    }\r\n    drawBitmap(repeat, tex, x, y, width = 0, height = 0) {\r\n        if (width < 0.1 || height < 0.1)\r\n            return;\r\n        if (repeat && (tex.width != width || tex.height != height))\r\n            this.fillTexture(tex, x, y, width, height);\r\n        else\r\n            this.drawImage(tex, x, y, width, height);\r\n    }\r\n    static getTexture(tex, x, y, width, height) {\r\n        if (width <= 0)\r\n            width = 1;\r\n        if (height <= 0)\r\n            height = 1;\r\n        tex.$_GID || (tex.$_GID = Utils.getGID());\r\n        var texture;\r\n        if (!texture || !texture._getSource()) {\r\n            texture = Texture.createFromTexture(tex, x, y, width, height);\r\n        }\r\n        return texture;\r\n    }\r\n    _setDrawGridCmd(newcmd) {\r\n        var source = this._source;\r\n        if (!source || !source.bitmap) {\r\n            return;\r\n        }\r\n        let cmds = this.cmds;\r\n        if (!this._one && (!cmds || cmds.length <= 0)) {\r\n            this._saveToCmd(null, newcmd);\r\n        }\r\n        else {\r\n            let lastOne = this._one;\r\n            if (lastOne) {\r\n                if (lastOne == this._drawGridCmd) {\r\n                    this._one = newcmd;\r\n                }\r\n                else {\r\n                    this.clear();\r\n                    this._saveToCmd(null, newcmd);\r\n                    this._saveToCmd(null, lastOne);\r\n                }\r\n            }\r\n            else {\r\n                cmds.splice(0, 0, newcmd);\r\n            }\r\n        }\r\n        this._drawGridCmd = newcmd;\r\n    }\r\n}\r\nClassUtils.regClass(\"laya.ui.AutoBitmap\", AutoBitmap);\r\nClassUtils.regClass(\"Laya.AutoBitmap\", AutoBitmap);\r\n",
  "references": [
    "F:/ProjectsWorks/font_game_2.10/libs/laya/display/Graphics.ts",
    "F:/ProjectsWorks/font_game_2.10/libs/laya/resource/Texture.ts",
    "F:/ProjectsWorks/font_game_2.10/libs/laya/utils/Utils.ts",
    "F:/ProjectsWorks/font_game_2.10/libs/laya/utils/ClassUtils.ts",
    "F:/ProjectsWorks/font_game_2.10/libs/ILaya.ts",
    "F:/ProjectsWorks/font_game_2.10/libs/laya/display/cmd/Draw9GridTexture.ts",
    "F:/ProjectsWorks/font_game_2.10/libs/laya/display/cmd/DrawTextureCmd.ts",
    "F:/ProjectsWorks/font_game_2.10/libs/laya/display/SpriteConst.ts",
    "F:/ProjectsWorks/font_game_2.10/libs/laya/maths/Matrix.ts"
  ],
  "dts": {
    "name": "F:/ProjectsWorks/font_game_2.10/libs/laya/ui/AutoBitmap.d.ts",
    "writeByteOrderMark": false,
    "text": "import { Graphics } from \"../display/Graphics\";\r\nimport { Texture } from \"../resource/Texture\";\r\nexport declare class AutoBitmap extends Graphics {\r\n    autoCacheCmd: boolean;\r\n    private _width;\r\n    private _height;\r\n    private _source;\r\n    private _sizeGrid;\r\n    protected _isChanged: boolean;\r\n    _offset: any[];\r\n    uv: number[];\r\n    private _drawGridCmd;\r\n    destroy(): void;\r\n    sizeGrid: number[];\r\n    width: number;\r\n    height: number;\r\n    source: Texture;\r\n    protected _setChanged(): void;\r\n    private _createDrawTexture;\r\n    protected changeSource(): void;\r\n    private drawBitmap;\r\n    private static getTexture;\r\n    private _setDrawGridCmd;\r\n}\r\n"
  }
}

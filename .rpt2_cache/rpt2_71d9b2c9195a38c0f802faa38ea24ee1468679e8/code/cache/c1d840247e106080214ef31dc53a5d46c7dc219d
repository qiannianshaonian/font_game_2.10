{
  "code": "import { Rectangle } from \"../maths/Rectangle\";\r\nimport { Texture } from \"../resource/Texture\";\r\nimport { Handler } from \"../utils/Handler\";\r\nimport { ILaya } from \"../../ILaya\";\r\nimport { ClassUtils } from \"../utils/ClassUtils\";\r\nexport class BitmapFont {\r\n    constructor() {\r\n        this._fontCharDic = {};\r\n        this._fontWidthMap = {};\r\n        this._maxWidth = 0;\r\n        this._spaceWidth = 10;\r\n        this.fontSize = 12;\r\n        this.autoScaleSize = false;\r\n        this.letterSpacing = 0;\r\n    }\r\n    loadFont(path, complete) {\r\n        this._path = path;\r\n        this._complete = complete;\r\n        if (!path || path.indexOf(\".fnt\") === -1) {\r\n            console.error('Bitmap font configuration information must be a \".fnt\" file');\r\n            return;\r\n        }\r\n        ILaya.loader.load([{ url: path, type: ILaya.Loader.XML }, { url: path.replace(\".fnt\", \".png\"), type: ILaya.Loader.IMAGE }], Handler.create(this, this._onLoaded));\r\n    }\r\n    _onLoaded() {\r\n        this.parseFont(ILaya.Loader.getRes(this._path), ILaya.Loader.getRes(this._path.replace(\".fnt\", \".png\")));\r\n        this._complete && this._complete.run();\r\n    }\r\n    parseFont(xml, texture) {\r\n        if (xml == null || texture == null)\r\n            return;\r\n        this._texture = texture;\r\n        var tX = 0;\r\n        var tScale = 1;\r\n        var tInfo = xml.getElementsByTagName(\"info\");\r\n        if (!tInfo[0].getAttributeNode) {\r\n            return this.parseFont2(xml, texture);\r\n        }\r\n        this.fontSize = parseInt(tInfo[0].getAttributeNode(\"size\").nodeValue);\r\n        var tPadding = tInfo[0].getAttributeNode(\"padding\").nodeValue;\r\n        var tPaddingArray = tPadding.split(\",\");\r\n        this._padding = [parseInt(tPaddingArray[0]), parseInt(tPaddingArray[1]), parseInt(tPaddingArray[2]), parseInt(tPaddingArray[3])];\r\n        var chars = xml.getElementsByTagName(\"char\");\r\n        var i = 0;\r\n        for (i = 0; i < chars.length; i++) {\r\n            var tAttribute = chars[i];\r\n            var tId = parseInt(tAttribute.getAttributeNode(\"id\").nodeValue);\r\n            var xOffset = parseInt(tAttribute.getAttributeNode(\"xoffset\").nodeValue) / tScale;\r\n            var yOffset = parseInt(tAttribute.getAttributeNode(\"yoffset\").nodeValue) / tScale;\r\n            var xAdvance = parseInt(tAttribute.getAttributeNode(\"xadvance\").nodeValue) / tScale;\r\n            var region = new Rectangle();\r\n            region.x = parseInt(tAttribute.getAttributeNode(\"x\").nodeValue);\r\n            region.y = parseInt(tAttribute.getAttributeNode(\"y\").nodeValue);\r\n            region.width = parseInt(tAttribute.getAttributeNode(\"width\").nodeValue);\r\n            region.height = parseInt(tAttribute.getAttributeNode(\"height\").nodeValue);\r\n            var tTexture = Texture.create(texture, region.x, region.y, region.width, region.height, xOffset, yOffset);\r\n            this._maxWidth = Math.max(this._maxWidth, xAdvance + this.letterSpacing);\r\n            this._fontCharDic[tId] = tTexture;\r\n            this._fontWidthMap[tId] = xAdvance;\r\n        }\r\n    }\r\n    parseFont2(xml, texture) {\r\n        if (xml == null || texture == null)\r\n            return;\r\n        this._texture = texture;\r\n        var tX = 0;\r\n        var tScale = 1;\r\n        var tInfo = xml.getElementsByTagName(\"info\");\r\n        this.fontSize = parseInt(tInfo[0].attributes[\"size\"].nodeValue);\r\n        var tPadding = tInfo[0].attributes[\"padding\"].nodeValue;\r\n        var tPaddingArray = tPadding.split(\",\");\r\n        this._padding = [parseInt(tPaddingArray[0]), parseInt(tPaddingArray[1]), parseInt(tPaddingArray[2]), parseInt(tPaddingArray[3])];\r\n        var chars = xml.getElementsByTagName(\"char\");\r\n        var i = 0;\r\n        for (i = 0; i < chars.length; i++) {\r\n            var tAttribute = chars[i].attributes;\r\n            var tId = parseInt(tAttribute[\"id\"].nodeValue);\r\n            var xOffset = parseInt(tAttribute[\"xoffset\"].nodeValue) / tScale;\r\n            var yOffset = parseInt(tAttribute[\"yoffset\"].nodeValue) / tScale;\r\n            var xAdvance = parseInt(tAttribute[\"xadvance\"].nodeValue) / tScale;\r\n            var region = new Rectangle();\r\n            region.x = parseInt(tAttribute[\"x\"].nodeValue);\r\n            region.y = parseInt(tAttribute[\"y\"].nodeValue);\r\n            region.width = parseInt(tAttribute[\"width\"].nodeValue);\r\n            region.height = parseInt(tAttribute[\"height\"].nodeValue);\r\n            var tTexture = Texture.create(texture, region.x, region.y, region.width, region.height, xOffset, yOffset);\r\n            this._maxWidth = Math.max(this._maxWidth, xAdvance + this.letterSpacing);\r\n            this._fontCharDic[tId] = tTexture;\r\n            this._fontWidthMap[tId] = xAdvance;\r\n        }\r\n    }\r\n    getCharTexture(char) {\r\n        return this._fontCharDic[char.charCodeAt(0)];\r\n    }\r\n    destroy() {\r\n        if (this._texture) {\r\n            for (var p in this._fontCharDic) {\r\n                var tTexture = this._fontCharDic[p];\r\n                if (tTexture)\r\n                    tTexture.destroy();\r\n            }\r\n            this._texture.destroy();\r\n            this._fontCharDic = null;\r\n            this._fontWidthMap = null;\r\n            this._texture = null;\r\n            this._complete = null;\r\n            this._padding = null;\r\n        }\r\n    }\r\n    setSpaceWidth(spaceWidth) {\r\n        this._spaceWidth = spaceWidth;\r\n    }\r\n    getCharWidth(char) {\r\n        var code = char.charCodeAt(0);\r\n        if (this._fontWidthMap[code])\r\n            return this._fontWidthMap[code] + this.letterSpacing;\r\n        if (char === \" \")\r\n            return this._spaceWidth + this.letterSpacing;\r\n        return 0;\r\n    }\r\n    getTextWidth(text) {\r\n        var tWidth = 0;\r\n        for (var i = 0, n = text.length; i < n; i++) {\r\n            tWidth += this.getCharWidth(text.charAt(i));\r\n        }\r\n        return tWidth;\r\n    }\r\n    getMaxWidth() {\r\n        return this._maxWidth;\r\n    }\r\n    getMaxHeight() {\r\n        return this.fontSize;\r\n    }\r\n    _drawText(text, sprite, drawX, drawY, align, width) {\r\n        var tWidth = this.getTextWidth(text);\r\n        var tTexture;\r\n        var dx = 0;\r\n        align === \"center\" && (dx = (width - tWidth) / 2);\r\n        align === \"right\" && (dx = (width - tWidth));\r\n        var tx = 0;\r\n        for (var i = 0, n = text.length; i < n; i++) {\r\n            tTexture = this.getCharTexture(text.charAt(i));\r\n            if (tTexture) {\r\n                sprite.graphics.drawImage(tTexture, drawX + tx + dx, drawY);\r\n                tx += this.getCharWidth(text.charAt(i));\r\n            }\r\n        }\r\n    }\r\n}\r\nClassUtils.regClass(\"laya.display.BitmapFont\", BitmapFont);\r\nClassUtils.regClass(\"Laya.BitmapFont\", BitmapFont);\r\n",
  "references": [
    "F:/ProjectsWorks/font_game_2.10/libs/laya/display/Sprite.ts",
    "F:/ProjectsWorks/font_game_2.10/libs/laya/maths/Rectangle.ts",
    "F:/ProjectsWorks/font_game_2.10/libs/laya/resource/Texture.ts",
    "F:/ProjectsWorks/font_game_2.10/libs/laya/utils/Handler.ts",
    "F:/ProjectsWorks/font_game_2.10/libs/ILaya.ts",
    "F:/ProjectsWorks/font_game_2.10/libs/laya/utils/ClassUtils.ts"
  ],
  "dts": {
    "name": "F:/ProjectsWorks/font_game_2.10/libs/laya/display/BitmapFont.d.ts",
    "writeByteOrderMark": false,
    "text": "import { Sprite } from \"./Sprite\";\r\nimport { Texture } from \"../resource/Texture\";\r\nimport { Handler } from \"../utils/Handler\";\r\nexport declare class BitmapFont {\r\n    private _texture;\r\n    private _fontCharDic;\r\n    private _fontWidthMap;\r\n    private _complete;\r\n    private _path;\r\n    private _maxWidth;\r\n    private _spaceWidth;\r\n    private _padding;\r\n    fontSize: number;\r\n    autoScaleSize: boolean;\r\n    letterSpacing: number;\r\n    loadFont(path: string, complete: Handler): void;\r\n    private _onLoaded;\r\n    parseFont(xml: XMLDocument, texture: Texture): void;\r\n    parseFont2(xml: XMLDocument, texture: Texture): void;\r\n    getCharTexture(char: string): Texture;\r\n    destroy(): void;\r\n    setSpaceWidth(spaceWidth: number): void;\r\n    getCharWidth(char: string): number;\r\n    getTextWidth(text: string): number;\r\n    getMaxWidth(): number;\r\n    getMaxHeight(): number;\r\n    _drawText(text: string, sprite: Sprite, drawX: number, drawY: number, align: string, width: number): void;\r\n}\r\n"
  }
}

{
  "code": "import { Event } from \"../events/Event\";\r\nimport { MouseManager } from \"../events/MouseManager\";\r\nimport { ILaya } from \"./../../ILaya\";\r\nimport { Ease } from \"./Ease\";\r\nimport { Handler } from \"./Handler\";\r\nimport { Tween } from \"./Tween\";\r\nexport class Dragging {\r\n    constructor() {\r\n        this.ratio = 0.92;\r\n        this.maxOffset = 60;\r\n        this._dragging = false;\r\n        this._clickOnly = true;\r\n    }\r\n    start(target, area, hasInertia, elasticDistance, elasticBackTime, data, disableMouseEvent, ratio = 0.92) {\r\n        this.clearTimer();\r\n        this.target = target;\r\n        this.area = area;\r\n        this.hasInertia = hasInertia;\r\n        this.elasticDistance = area ? elasticDistance : 0;\r\n        this.elasticBackTime = elasticBackTime;\r\n        this.data = data;\r\n        this._disableMouseEvent = disableMouseEvent;\r\n        this.ratio = ratio;\r\n        this._parent = target.parent;\r\n        this._clickOnly = true;\r\n        this._dragging = true;\r\n        this._elasticRateX = this._elasticRateY = 1;\r\n        this._lastX = this._parent.mouseX;\r\n        this._lastY = this._parent.mouseY;\r\n        ILaya.stage.on(Event.MOUSE_UP, this, this.onStageMouseUp);\r\n        ILaya.stage.on(Event.MOUSE_OUT, this, this.onStageMouseUp);\r\n        ILaya.systemTimer.frameLoop(1, this, this.loop);\r\n    }\r\n    clearTimer() {\r\n        ILaya.systemTimer.clear(this, this.loop);\r\n        ILaya.systemTimer.clear(this, this.tweenMove);\r\n        if (this._tween) {\r\n            this._tween.recover();\r\n            this._tween = null;\r\n        }\r\n    }\r\n    stop() {\r\n        if (this._dragging) {\r\n            MouseManager.instance.disableMouseEvent = false;\r\n            ILaya.stage.off(Event.MOUSE_UP, this, this.onStageMouseUp);\r\n            ILaya.stage.off(Event.MOUSE_OUT, this, this.onStageMouseUp);\r\n            this._dragging = false;\r\n            this.target && this.area && this.backToArea();\r\n            this.clear();\r\n        }\r\n    }\r\n    loop() {\r\n        var point = this._parent.getMousePoint();\r\n        var mouseX = point.x;\r\n        var mouseY = point.y;\r\n        var offsetX = mouseX - this._lastX;\r\n        var offsetY = mouseY - this._lastY;\r\n        if (this._clickOnly) {\r\n            if (Math.abs(offsetX * ILaya.stage._canvasTransform.getScaleX()) > 1 || Math.abs(offsetY * ILaya.stage._canvasTransform.getScaleY()) > 1) {\r\n                this._clickOnly = false;\r\n                this._offsets || (this._offsets = []);\r\n                this._offsets.length = 0;\r\n                this.target.event(Event.DRAG_START, this.data);\r\n                MouseManager.instance.disableMouseEvent = this._disableMouseEvent;\r\n            }\r\n            else\r\n                return;\r\n        }\r\n        else {\r\n            this._offsets.push(offsetX, offsetY);\r\n        }\r\n        if (offsetX === 0 && offsetY === 0)\r\n            return;\r\n        this._lastX = mouseX;\r\n        this._lastY = mouseY;\r\n        this.target.x += offsetX * this._elasticRateX;\r\n        this.target.y += offsetY * this._elasticRateY;\r\n        this.area && this.checkArea();\r\n        this.target.event(Event.DRAG_MOVE, this.data);\r\n    }\r\n    checkArea() {\r\n        if (this.elasticDistance <= 0) {\r\n            this.backToArea();\r\n        }\r\n        else {\r\n            if (this.target._x < this.area.x) {\r\n                var offsetX = this.area.x - this.target._x;\r\n            }\r\n            else if (this.target._x > this.area.x + this.area.width) {\r\n                offsetX = this.target._x - this.area.x - this.area.width;\r\n            }\r\n            else {\r\n                offsetX = 0;\r\n            }\r\n            this._elasticRateX = Math.max(0, 1 - (offsetX / this.elasticDistance));\r\n            if (this.target._y < this.area.y) {\r\n                var offsetY = this.area.y - this.target.y;\r\n            }\r\n            else if (this.target._y > this.area.y + this.area.height) {\r\n                offsetY = this.target._y - this.area.y - this.area.height;\r\n            }\r\n            else {\r\n                offsetY = 0;\r\n            }\r\n            this._elasticRateY = Math.max(0, 1 - (offsetY / this.elasticDistance));\r\n        }\r\n    }\r\n    backToArea() {\r\n        this.target.x = Math.min(Math.max(this.target._x, this.area.x), this.area.x + this.area.width);\r\n        this.target.y = Math.min(Math.max(this.target._y, this.area.y), this.area.y + this.area.height);\r\n    }\r\n    onStageMouseUp(e) {\r\n        MouseManager.instance.disableMouseEvent = false;\r\n        ILaya.stage.off(Event.MOUSE_UP, this, this.onStageMouseUp);\r\n        ILaya.stage.off(Event.MOUSE_OUT, this, this.onStageMouseUp);\r\n        ILaya.systemTimer.clear(this, this.loop);\r\n        if (this._clickOnly || !this.target)\r\n            return;\r\n        if (this.hasInertia) {\r\n            if (this._offsets.length < 1) {\r\n                this._offsets.push(this._parent.mouseX - this._lastX, this._parent.mouseY - this._lastY);\r\n            }\r\n            this._offsetX = this._offsetY = 0;\r\n            var len = this._offsets.length;\r\n            var n = Math.min(len, 6);\r\n            var m = this._offsets.length - n;\r\n            for (var i = len - 1; i > m; i--) {\r\n                this._offsetY += this._offsets[i--];\r\n                this._offsetX += this._offsets[i];\r\n            }\r\n            this._offsetX = this._offsetX / n * 2;\r\n            this._offsetY = this._offsetY / n * 2;\r\n            if (Math.abs(this._offsetX) > this.maxOffset)\r\n                this._offsetX = this._offsetX > 0 ? this.maxOffset : -this.maxOffset;\r\n            if (Math.abs(this._offsetY) > this.maxOffset)\r\n                this._offsetY = this._offsetY > 0 ? this.maxOffset : -this.maxOffset;\r\n            ILaya.systemTimer.frameLoop(1, this, this.tweenMove);\r\n        }\r\n        else if (this.elasticDistance > 0) {\r\n            this.checkElastic();\r\n        }\r\n        else {\r\n            this.clear();\r\n        }\r\n    }\r\n    checkElastic() {\r\n        var tx = NaN;\r\n        var ty = NaN;\r\n        if (this.target.x < this.area.x)\r\n            tx = this.area.x;\r\n        else if (this.target._x > this.area.x + this.area.width)\r\n            tx = this.area.x + this.area.width;\r\n        if (this.target.y < this.area.y)\r\n            ty = this.area.y;\r\n        else if (this.target._y > this.area.y + this.area.height)\r\n            ty = this.area.y + this.area.height;\r\n        if (!isNaN(tx) || !isNaN(ty)) {\r\n            var obj = {};\r\n            if (!isNaN(tx))\r\n                obj.x = tx;\r\n            if (!isNaN(ty))\r\n                obj.y = ty;\r\n            this._tween = Tween.to(this.target, obj, this.elasticBackTime, Ease.sineOut, Handler.create(this, this.clear), 0, false, false);\r\n        }\r\n        else {\r\n            this.clear();\r\n        }\r\n    }\r\n    tweenMove() {\r\n        this._offsetX *= this.ratio * this._elasticRateX;\r\n        this._offsetY *= this.ratio * this._elasticRateY;\r\n        this.target.x += this._offsetX;\r\n        this.target.y += this._offsetY;\r\n        this.area && this.checkArea();\r\n        this.target.event(Event.DRAG_MOVE, this.data);\r\n        if ((Math.abs(this._offsetX) < 1 && Math.abs(this._offsetY) < 1) || this._elasticRateX < 0.5 || this._elasticRateY < 0.5) {\r\n            ILaya.systemTimer.clear(this, this.tweenMove);\r\n            if (this.elasticDistance > 0)\r\n                this.checkElastic();\r\n            else\r\n                this.clear();\r\n        }\r\n    }\r\n    clear() {\r\n        if (this.target) {\r\n            this.clearTimer();\r\n            var sp = this.target;\r\n            this.target = null;\r\n            this._parent = null;\r\n            sp.event(Event.DRAG_END, this.data);\r\n        }\r\n    }\r\n}\r\n",
  "references": [
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/display/Sprite.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/events/Event.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/events/MouseManager.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/maths/Point.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/maths/Rectangle.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/ILaya.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/utils/Ease.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/utils/Handler.ts",
    "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/utils/Tween.ts"
  ],
  "dts": {
    "name": "/Users/zonst/Documents/font2.0/font_game_2.10/libs/laya/utils/Dragging.d.ts",
    "writeByteOrderMark": false,
    "text": "import { Sprite } from \"../display/Sprite\";\r\nimport { Rectangle } from \"../maths/Rectangle\";\r\nexport declare class Dragging {\r\n    target: Sprite;\r\n    ratio: number;\r\n    maxOffset: number;\r\n    area: Rectangle;\r\n    hasInertia: boolean;\r\n    elasticDistance: number;\r\n    elasticBackTime: number;\r\n    data: any;\r\n    private _dragging;\r\n    private _clickOnly;\r\n    private _elasticRateX;\r\n    private _elasticRateY;\r\n    private _lastX;\r\n    private _lastY;\r\n    private _offsetX;\r\n    private _offsetY;\r\n    private _offsets;\r\n    private _disableMouseEvent;\r\n    private _tween;\r\n    private _parent;\r\n    start(target: Sprite, area: Rectangle, hasInertia: boolean, elasticDistance: number, elasticBackTime: number, data: any, disableMouseEvent: boolean, ratio?: number): void;\r\n    private clearTimer;\r\n    stop(): void;\r\n    private loop;\r\n    private checkArea;\r\n    private backToArea;\r\n    private onStageMouseUp;\r\n    private checkElastic;\r\n    private tweenMove;\r\n    private clear;\r\n}\r\n"
  }
}

{
  "code": "import { ILaya } from \"../../ILaya\";\r\nexport class CallLater {\r\n    constructor() {\r\n        this._pool = [];\r\n        this._map = {};\r\n        this._laters = [];\r\n    }\r\n    _update() {\r\n        let laters = this._laters;\r\n        let len = laters.length;\r\n        if (len > 0) {\r\n            for (let i = 0, n = len - 1; i <= n; i++) {\r\n                let handler = laters[i];\r\n                this._map[handler.key] = null;\r\n                if (handler.method !== null) {\r\n                    handler.run();\r\n                    handler.clear();\r\n                }\r\n                this._pool.push(handler);\r\n                i === n && (n = laters.length - 1);\r\n            }\r\n            laters.length = 0;\r\n        }\r\n    }\r\n    _getHandler(caller, method) {\r\n        var cid = caller ? caller.$_GID || (caller.$_GID = ILaya.Utils.getGID()) : 0;\r\n        var mid = method.$_TID || (method.$_TID = (ILaya.Timer._mid++));\r\n        return this._map[cid + '.' + mid];\r\n    }\r\n    callLater(caller, method, args = null) {\r\n        if (this._getHandler(caller, method) == null) {\r\n            let handler;\r\n            if (this._pool.length)\r\n                handler = this._pool.pop();\r\n            else\r\n                handler = new LaterHandler();\r\n            handler.caller = caller;\r\n            handler.method = method;\r\n            handler.args = args;\r\n            var cid = caller ? caller.$_GID : 0;\r\n            var mid = method[\"$_TID\"];\r\n            handler.key = cid + '.' + mid;\r\n            this._map[handler.key] = handler;\r\n            this._laters.push(handler);\r\n        }\r\n    }\r\n    runCallLater(caller, method) {\r\n        var handler = this._getHandler(caller, method);\r\n        if (handler && handler.method != null) {\r\n            this._map[handler.key] = null;\r\n            handler.run();\r\n            handler.clear();\r\n        }\r\n    }\r\n}\r\nCallLater.I = new CallLater();\r\nclass LaterHandler {\r\n    clear() {\r\n        this.caller = null;\r\n        this.method = null;\r\n        this.args = null;\r\n    }\r\n    run() {\r\n        var caller = this.caller;\r\n        if (caller && caller.destroyed)\r\n            return this.clear();\r\n        var method = this.method;\r\n        var args = this.args;\r\n        if (method == null)\r\n            return;\r\n        args ? method.apply(caller, args) : method.call(caller);\r\n    }\r\n}\r\n",
  "references": [
    "F:/ProjectsWorks/font_game_2.10/libs/ILaya.ts"
  ],
  "dts": {
    "name": "F:/ProjectsWorks/font_game_2.10/.rpt2_cache/placeholder/laya/utils/CallLater.d.ts",
    "writeByteOrderMark": false,
    "text": "export declare class CallLater {\r\n    static I: CallLater;\r\n    private _pool;\r\n    private _map;\r\n    private _laters;\r\n    _update(): void;\r\n    private _getHandler;\r\n    callLater(caller: any, method: Function, args?: any[]): void;\r\n    runCallLater(caller: any, method: Function): void;\r\n}\r\n"
  }
}

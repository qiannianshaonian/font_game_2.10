{
  "code": "import { AlphaCmd } from \"./cmd/AlphaCmd\";\r\nimport { DrawCircleCmd } from \"./cmd/DrawCircleCmd\";\r\nimport { DrawCurvesCmd } from \"./cmd/DrawCurvesCmd\";\r\nimport { DrawImageCmd } from \"./cmd/DrawImageCmd\";\r\nimport { DrawLineCmd } from \"./cmd/DrawLineCmd\";\r\nimport { DrawLinesCmd } from \"./cmd/DrawLinesCmd\";\r\nimport { DrawPathCmd } from \"./cmd/DrawPathCmd\";\r\nimport { DrawPieCmd } from \"./cmd/DrawPieCmd\";\r\nimport { DrawPolyCmd } from \"./cmd/DrawPolyCmd\";\r\nimport { DrawRectCmd } from \"./cmd/DrawRectCmd\";\r\nimport { DrawTextureCmd } from \"./cmd/DrawTextureCmd\";\r\nimport { FillTextureCmd } from \"./cmd/FillTextureCmd\";\r\nimport { RestoreCmd } from \"./cmd/RestoreCmd\";\r\nimport { RotateCmd } from \"./cmd/RotateCmd\";\r\nimport { ScaleCmd } from \"./cmd/ScaleCmd\";\r\nimport { TransformCmd } from \"./cmd/TransformCmd\";\r\nimport { TranslateCmd } from \"./cmd/TranslateCmd\";\r\nimport { Bezier } from \"../maths/Bezier\";\r\nimport { GrahamScan } from \"../maths/GrahamScan\";\r\nimport { Matrix } from \"../maths/Matrix\";\r\nimport { Point } from \"../maths/Point\";\r\nimport { Rectangle } from \"../maths/Rectangle\";\r\nimport { Render } from \"../renders/Render\";\r\nimport { Pool } from \"../utils/Pool\";\r\nimport { Utils } from \"../utils/Utils\";\r\nimport { DrawTrianglesCmd } from \"./cmd/DrawTrianglesCmd\";\r\nimport { Draw9GridTexture } from \"./cmd/Draw9GridTexture\";\r\nimport { SaveCmd } from \"./cmd/SaveCmd\";\r\nexport class GraphicsBounds {\r\n    constructor() {\r\n        this._cacheBoundsType = false;\r\n    }\r\n    destroy() {\r\n        this._graphics = null;\r\n        this._cacheBoundsType = false;\r\n        if (this._temp)\r\n            this._temp.length = 0;\r\n        if (this._rstBoundPoints)\r\n            this._rstBoundPoints.length = 0;\r\n        if (this._bounds)\r\n            this._bounds.recover();\r\n        this._bounds = null;\r\n        Pool.recover(\"GraphicsBounds\", this);\r\n    }\r\n    static create() {\r\n        return Pool.getItemByClass(\"GraphicsBounds\", GraphicsBounds);\r\n    }\r\n    reset() {\r\n        this._temp && (this._temp.length = 0);\r\n    }\r\n    getBounds(realSize = false) {\r\n        if (!this._bounds || !this._temp || this._temp.length < 1 || realSize != this._cacheBoundsType) {\r\n            this._bounds = Rectangle._getWrapRec(this.getBoundPoints(realSize), this._bounds);\r\n        }\r\n        this._cacheBoundsType = realSize;\r\n        return this._bounds;\r\n    }\r\n    getBoundPoints(realSize = false) {\r\n        if (!this._temp || this._temp.length < 1 || realSize != this._cacheBoundsType)\r\n            this._temp = this._getCmdPoints(realSize);\r\n        this._cacheBoundsType = realSize;\r\n        return this._rstBoundPoints = Utils.copyArray(this._rstBoundPoints, this._temp);\r\n    }\r\n    _getCmdPoints(realSize = false) {\r\n        var context = Render._context;\r\n        var cmds = this._graphics.cmds;\r\n        var rst;\r\n        rst = this._temp || (this._temp = []);\r\n        rst.length = 0;\r\n        if (!cmds && this._graphics._one != null) {\r\n            GraphicsBounds._tempCmds.length = 0;\r\n            GraphicsBounds._tempCmds.push(this._graphics._one);\r\n            cmds = GraphicsBounds._tempCmds;\r\n        }\r\n        if (!cmds)\r\n            return rst;\r\n        var matrixs = GraphicsBounds._tempMatrixArrays;\r\n        matrixs.length = 0;\r\n        var tMatrix = GraphicsBounds._initMatrix;\r\n        tMatrix.identity();\r\n        var tempMatrix = GraphicsBounds._tempMatrix;\r\n        var cmd;\r\n        var tex;\r\n        for (var i = 0, n = cmds.length; i < n; i++) {\r\n            cmd = cmds[i];\r\n            switch (cmd.cmdID) {\r\n                case AlphaCmd.ID:\r\n                case SaveCmd.ID:\r\n                    matrixs.push(tMatrix);\r\n                    tMatrix = tMatrix.clone();\r\n                    break;\r\n                case RestoreCmd.ID:\r\n                    tMatrix = matrixs.pop();\r\n                    break;\r\n                case ScaleCmd.ID:\r\n                    tempMatrix.identity();\r\n                    tempMatrix.translate(-cmd.pivotX, -cmd.pivotY);\r\n                    tempMatrix.scale(cmd.scaleX, cmd.scaleY);\r\n                    tempMatrix.translate(cmd.pivotX, cmd.pivotY);\r\n                    this._switchMatrix(tMatrix, tempMatrix);\r\n                    break;\r\n                case RotateCmd.ID:\r\n                    tempMatrix.identity();\r\n                    tempMatrix.translate(-cmd.pivotX, -cmd.pivotY);\r\n                    tempMatrix.rotate(cmd.angle);\r\n                    tempMatrix.translate(cmd.pivotX, cmd.pivotY);\r\n                    this._switchMatrix(tMatrix, tempMatrix);\r\n                    break;\r\n                case TranslateCmd.ID:\r\n                    tempMatrix.identity();\r\n                    tempMatrix.translate(cmd.tx, cmd.ty);\r\n                    this._switchMatrix(tMatrix, tempMatrix);\r\n                    break;\r\n                case TransformCmd.ID:\r\n                    tempMatrix.identity();\r\n                    tempMatrix.translate(-cmd.pivotX, -cmd.pivotY);\r\n                    tempMatrix.concat(cmd.matrix);\r\n                    tempMatrix.translate(cmd.pivotX, cmd.pivotY);\r\n                    this._switchMatrix(tMatrix, tempMatrix);\r\n                    break;\r\n                case DrawImageCmd.ID:\r\n                case FillTextureCmd.ID:\r\n                    GraphicsBounds._addPointArrToRst(rst, Rectangle._getBoundPointS(cmd.x, cmd.y, cmd.width, cmd.height), tMatrix);\r\n                    break;\r\n                case DrawTextureCmd.ID:\r\n                    tMatrix.copyTo(tempMatrix);\r\n                    if (cmd.matrix)\r\n                        tempMatrix.concat(cmd.matrix);\r\n                    GraphicsBounds._addPointArrToRst(rst, Rectangle._getBoundPointS(cmd.x, cmd.y, cmd.width, cmd.height), tempMatrix);\r\n                    break;\r\n                case DrawImageCmd.ID:\r\n                    tex = cmd.texture;\r\n                    if (realSize) {\r\n                        if (cmd.width && cmd.height) {\r\n                            GraphicsBounds._addPointArrToRst(rst, Rectangle._getBoundPointS(cmd.x, cmd.y, cmd.width, cmd.height), tMatrix);\r\n                        }\r\n                        else {\r\n                            GraphicsBounds._addPointArrToRst(rst, Rectangle._getBoundPointS(cmd.x, cmd.y, tex.width, tex.height), tMatrix);\r\n                        }\r\n                    }\r\n                    else {\r\n                        var wRate = (cmd.width || tex.sourceWidth) / tex.width;\r\n                        var hRate = (cmd.height || tex.sourceHeight) / tex.height;\r\n                        var oWidth = wRate * tex.sourceWidth;\r\n                        var oHeight = hRate * tex.sourceHeight;\r\n                        var offX = tex.offsetX > 0 ? tex.offsetX : 0;\r\n                        var offY = tex.offsetY > 0 ? tex.offsetY : 0;\r\n                        offX *= wRate;\r\n                        offY *= hRate;\r\n                        GraphicsBounds._addPointArrToRst(rst, Rectangle._getBoundPointS(cmd.x - offX, cmd.y - offY, oWidth, oHeight), tMatrix);\r\n                    }\r\n                    break;\r\n                case FillTextureCmd.ID:\r\n                    if (cmd.width && cmd.height) {\r\n                        GraphicsBounds._addPointArrToRst(rst, Rectangle._getBoundPointS(cmd.x, cmd.y, cmd.width, cmd.height), tMatrix);\r\n                    }\r\n                    else {\r\n                        tex = cmd.texture;\r\n                        GraphicsBounds._addPointArrToRst(rst, Rectangle._getBoundPointS(cmd.x, cmd.y, tex.width, tex.height), tMatrix);\r\n                    }\r\n                    break;\r\n                case DrawTextureCmd.ID:\r\n                    var drawMatrix;\r\n                    if (cmd.matrix) {\r\n                        tMatrix.copyTo(tempMatrix);\r\n                        tempMatrix.concat(cmd.matrix);\r\n                        drawMatrix = tempMatrix;\r\n                    }\r\n                    else {\r\n                        drawMatrix = tMatrix;\r\n                    }\r\n                    if (realSize) {\r\n                        if (cmd.width && cmd.height) {\r\n                            GraphicsBounds._addPointArrToRst(rst, Rectangle._getBoundPointS(cmd.x, cmd.y, cmd.width, cmd.height), drawMatrix);\r\n                        }\r\n                        else {\r\n                            tex = cmd.texture;\r\n                            GraphicsBounds._addPointArrToRst(rst, Rectangle._getBoundPointS(cmd.x, cmd.y, tex.width, tex.height), drawMatrix);\r\n                        }\r\n                    }\r\n                    else {\r\n                        tex = cmd.texture;\r\n                        wRate = (cmd.width || tex.sourceWidth) / tex.width;\r\n                        hRate = (cmd.height || tex.sourceHeight) / tex.height;\r\n                        oWidth = wRate * tex.sourceWidth;\r\n                        oHeight = hRate * tex.sourceHeight;\r\n                        offX = tex.offsetX > 0 ? tex.offsetX : 0;\r\n                        offY = tex.offsetY > 0 ? tex.offsetY : 0;\r\n                        offX *= wRate;\r\n                        offY *= hRate;\r\n                        GraphicsBounds._addPointArrToRst(rst, Rectangle._getBoundPointS(cmd.x - offX, cmd.y - offY, oWidth, oHeight), drawMatrix);\r\n                    }\r\n                    break;\r\n                case DrawRectCmd.ID:\r\n                    GraphicsBounds._addPointArrToRst(rst, Rectangle._getBoundPointS(cmd.x, cmd.y, cmd.width, cmd.height), tMatrix);\r\n                    break;\r\n                case DrawCircleCmd.ID:\r\n                    GraphicsBounds._addPointArrToRst(rst, Rectangle._getBoundPointS(cmd.x - cmd.radius, cmd.y - cmd.radius, cmd.radius + cmd.radius, cmd.radius + cmd.radius), tMatrix);\r\n                    break;\r\n                case DrawLineCmd.ID:\r\n                    GraphicsBounds._tempPoints.length = 0;\r\n                    var lineWidth;\r\n                    lineWidth = cmd.lineWidth * 0.5;\r\n                    if (cmd.fromX == cmd.toX) {\r\n                        GraphicsBounds._tempPoints.push(cmd.fromX + lineWidth, cmd.fromY, cmd.toX + lineWidth, cmd.toY, cmd.fromX - lineWidth, cmd.fromY, cmd.toX - lineWidth, cmd.toY);\r\n                    }\r\n                    else if (cmd.fromY == cmd.toY) {\r\n                        GraphicsBounds._tempPoints.push(cmd.fromX, cmd.fromY + lineWidth, cmd.toX, cmd.toY + lineWidth, cmd.fromX, cmd.fromY - lineWidth, cmd.toX, cmd.toY - lineWidth);\r\n                    }\r\n                    else {\r\n                        GraphicsBounds._tempPoints.push(cmd.fromX, cmd.fromY, cmd.toX, cmd.toY);\r\n                    }\r\n                    GraphicsBounds._addPointArrToRst(rst, GraphicsBounds._tempPoints, tMatrix);\r\n                    break;\r\n                case DrawCurvesCmd.ID:\r\n                    GraphicsBounds._addPointArrToRst(rst, Bezier.I.getBezierPoints(cmd.points), tMatrix, cmd.x, cmd.y);\r\n                    break;\r\n                case DrawLinesCmd.ID:\r\n                case DrawPolyCmd.ID:\r\n                    GraphicsBounds._addPointArrToRst(rst, cmd.points, tMatrix, cmd.x, cmd.y);\r\n                    break;\r\n                case DrawPathCmd.ID:\r\n                    GraphicsBounds._addPointArrToRst(rst, this._getPathPoints(cmd.paths), tMatrix, cmd.x, cmd.y);\r\n                    break;\r\n                case DrawPieCmd.ID:\r\n                    GraphicsBounds._addPointArrToRst(rst, this._getPiePoints(cmd.x, cmd.y, cmd.radius, cmd.startAngle, cmd.endAngle), tMatrix);\r\n                    break;\r\n                case DrawTrianglesCmd.ID:\r\n                    GraphicsBounds._addPointArrToRst(rst, this._getTriAngBBXPoints(cmd.vertices), tMatrix);\r\n                    break;\r\n                case Draw9GridTexture.ID:\r\n                    GraphicsBounds._addPointArrToRst(rst, this._getDraw9GridBBXPoints(cmd), tMatrix);\r\n                    break;\r\n            }\r\n        }\r\n        if (rst.length > 200) {\r\n            rst = Utils.copyArray(rst, Rectangle._getWrapRec(rst)._getBoundPoints());\r\n        }\r\n        else if (rst.length > 8)\r\n            rst = GrahamScan.scanPList(rst);\r\n        return rst;\r\n    }\r\n    _switchMatrix(tMatix, tempMatrix) {\r\n        tempMatrix.concat(tMatix);\r\n        tempMatrix.copyTo(tMatix);\r\n    }\r\n    static _addPointArrToRst(rst, points, matrix, dx = 0, dy = 0) {\r\n        var i, len;\r\n        len = points.length;\r\n        for (i = 0; i < len; i += 2) {\r\n            GraphicsBounds._addPointToRst(rst, points[i] + dx, points[i + 1] + dy, matrix);\r\n        }\r\n    }\r\n    static _addPointToRst(rst, x, y, matrix) {\r\n        var _tempPoint = Point.TEMP;\r\n        _tempPoint.setTo(x ? x : 0, y ? y : 0);\r\n        matrix.transformPoint(_tempPoint);\r\n        rst.push(_tempPoint.x, _tempPoint.y);\r\n    }\r\n    _getPiePoints(x, y, radius, startAngle, endAngle) {\r\n        var rst = GraphicsBounds._tempPoints;\r\n        GraphicsBounds._tempPoints.length = 0;\r\n        var k = Math.PI / 180;\r\n        var d1 = endAngle - startAngle;\r\n        if (d1 >= 360 || d1 <= -360) {\r\n            rst.push(x - radius, y - radius);\r\n            rst.push(x + radius, y - radius);\r\n            rst.push(x + radius, y + radius);\r\n            rst.push(x - radius, y + radius);\r\n            return rst;\r\n        }\r\n        rst.push(x, y);\r\n        var delta = d1 % 360;\r\n        if (delta < 0)\r\n            delta += 360;\r\n        var end1 = startAngle + delta;\r\n        var st = startAngle * k;\r\n        var ed = end1 * k;\r\n        rst.push(x + radius * Math.cos(st), y + radius * Math.sin(st));\r\n        rst.push(x + radius * Math.cos(ed), y + radius * Math.sin(ed));\r\n        var s1 = Math.ceil(startAngle / 90) * 90;\r\n        var s2 = Math.floor(end1 / 90) * 90;\r\n        for (var cs = s1; cs <= s2; cs += 90) {\r\n            var csr = cs * k;\r\n            rst.push(x + radius * Math.cos(csr), y + radius * Math.sin(csr));\r\n        }\r\n        return rst;\r\n    }\r\n    _getTriAngBBXPoints(vert) {\r\n        var vnum = vert.length;\r\n        if (vnum < 2)\r\n            return [];\r\n        var minx = vert[0];\r\n        var miny = vert[1];\r\n        var maxx = minx;\r\n        var maxy = miny;\r\n        for (var i = 2; i < vnum;) {\r\n            var cx = vert[i++];\r\n            var cy = vert[i++];\r\n            if (minx > cx)\r\n                minx = cx;\r\n            if (miny > cy)\r\n                miny = cy;\r\n            if (maxx < cx)\r\n                maxx = cx;\r\n            if (maxy < cy)\r\n                maxy = cy;\r\n        }\r\n        return [minx, miny, maxx, miny, maxx, maxy, minx, maxy];\r\n    }\r\n    _getDraw9GridBBXPoints(cmd) {\r\n        var minx = 0;\r\n        var miny = 0;\r\n        var maxx = cmd.width;\r\n        var maxy = cmd.height;\r\n        return [minx, miny, maxx, miny, maxx, maxy, minx, maxy];\r\n    }\r\n    _getPathPoints(paths) {\r\n        var i, len;\r\n        var rst = GraphicsBounds._tempPoints;\r\n        rst.length = 0;\r\n        len = paths.length;\r\n        var tCMD;\r\n        for (i = 0; i < len; i++) {\r\n            tCMD = paths[i];\r\n            if (tCMD.length > 1) {\r\n                rst.push(tCMD[1], tCMD[2]);\r\n                if (tCMD.length > 3) {\r\n                    rst.push(tCMD[3], tCMD[4]);\r\n                }\r\n            }\r\n        }\r\n        return rst;\r\n    }\r\n}\r\nGraphicsBounds._tempMatrix = new Matrix();\r\nGraphicsBounds._initMatrix = new Matrix();\r\nGraphicsBounds._tempPoints = [];\r\nGraphicsBounds._tempMatrixArrays = [];\r\nGraphicsBounds._tempCmds = [];\r\n",
  "references": [
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/AlphaCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/DrawCircleCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/DrawCurvesCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/DrawImageCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/DrawLineCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/DrawLinesCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/DrawPathCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/DrawPieCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/DrawPolyCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/DrawRectCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/DrawTextureCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/FillTextureCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/RestoreCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/RotateCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/ScaleCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/TransformCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/TranslateCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/maths/Bezier.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/maths/GrahamScan.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/maths/Matrix.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/maths/Point.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/maths/Rectangle.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/renders/Render.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/resource/Context.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/resource/Texture.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/utils/Pool.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/utils/Utils.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/Graphics.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/DrawTrianglesCmd.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/Draw9GridTexture.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/utils/ClassUtils.ts",
    "F:/ProjectsWorks/font_game_2ceshi/libs/laya/display/cmd/SaveCmd.ts"
  ],
  "dts": {
    "name": "F:/ProjectsWorks/font_game_2ceshi/.rpt2_cache/placeholder/laya/display/GraphicsBounds.d.ts",
    "writeByteOrderMark": false,
    "text": "import { Rectangle } from \"../maths/Rectangle\";\r\nimport { Graphics } from \"./Graphics\";\r\nexport declare class GraphicsBounds {\r\n    private static _tempMatrix;\r\n    private static _initMatrix;\r\n    private static _tempPoints;\r\n    private static _tempMatrixArrays;\r\n    private static _tempCmds;\r\n    private _temp;\r\n    private _bounds;\r\n    private _rstBoundPoints;\r\n    private _cacheBoundsType;\r\n    _graphics: Graphics;\r\n    destroy(): void;\r\n    static create(): GraphicsBounds;\r\n    reset(): void;\r\n    getBounds(realSize?: boolean): Rectangle;\r\n    getBoundPoints(realSize?: boolean): any[];\r\n    private _getCmdPoints;\r\n    private _switchMatrix;\r\n    private static _addPointArrToRst;\r\n    private static _addPointToRst;\r\n    private _getPiePoints;\r\n    private _getTriAngBBXPoints;\r\n    private _getDraw9GridBBXPoints;\r\n    private _getPathPoints;\r\n}\r\n"
  }
}

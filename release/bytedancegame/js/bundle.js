window.Laya=window.Laya||{},function(t){"use strict";class e extends t.Script{static addBtn(t){this._btns.push(t)}static removeBtn(t){this._btns.slice(this._btns.indexOf(t),1)}static hideAllBtn(){this._btns.forEach(t=>{t.style.hidden=!0})}static showAllBtn(){this._btns.forEach(t=>{t.style.hidden=!1})}}e._btns=[];class n extends t.Script{}class i extends Laya.Script{}i.prefabUrl="prefab/",i.spineUrl="res/spine/",i.soundUrl="sound/";class s extends t.Script{static getInitLoadingUrls(){return"wx"==s.platform?["res/atlas/map.atlas","res/data.json",i.spineUrl+"other_taozhuangxitong1.png",i.spineUrl+"other_wupinghuanrao_kin_little.png","res/atlas/test.atlas"]:["res/data.json",i.spineUrl+"other_taozhuangxitong1.sk",i.spineUrl+"other_wupinghuanrao_kin_little.sk"]}static getAsynUrls(){return["sound/hecheng.wav","sound/teji.wav","sound/xiahua.wav","sound/xiaochu.wav","sound/yidong.wav"]}static getMobileHeight(){if("wx"!=s.platform)return 1136;let e=t.Browser.window.wx.getSystemInfoSync();console.log("wx height:",e.windowHeight,", widht:",e.windowWidth);let n=640*e.windowHeight/e.windowWidth;return console.log("h:",n),n>1136?n:1136}static hadGuidance(){return"true"==localStorage.getItem("guide_tt1")}static setGuidance(t){t?localStorage.setItem("guide_tt1","true"):localStorage.setItem("guide_tt1","false")}static hadGuidanceHz(){return"true"==localStorage.getItem("guide_tthz")}static setGuidanceHz(t){t?localStorage.setItem("guide_tthz","true"):localStorage.setItem("guide_tthz","false")}static get isNative(){return!1}}s.asynUrlsLoaded=!1,s.pools={},s.platform="web",s.version="1.1.2";class o extends t.Script{onAwake(){n.curSceneScript=this,this.createWxOpenDataViewer();let t=Object.getOwnPropertyNames(this.owner),e=this;t.forEach(t=>{if(-1==t.indexOf("_"))return;let n=t.toString();switch(n.split("_")[0]){case"list":case"txt":case"img":case"btn":case"mc":e[n]=e.owner[n]}})}addPopUp(e,n,i=!0,o=!0,a=!1){this._popUpSign=e,this._popUpContent=n,null==this._popUpSpr?(this._popUpSpr=new t.Sprite,t.Laya.stage.addChild(this._popUpSpr)):this._popUpSpr.visible=!0;let r=s.getMobileHeight();i&&(n instanceof t.Sprite&&(n.x=(t.Laya.stage.width-n.width)/2,n.y=(r-n.height)/2),n instanceof t.Box&&(n.centerX=0,n.centerY=0)),o?(null==this._alphaSpr&&(this._alphaSpr=new t.Sprite,this._alphaSpr.width=t.Laya.stage.width,this._alphaSpr.height=t.Laya.stage.height,this._alphaSpr.graphics.drawRect(0,0,t.Laya.stage.width,r,"#000000"),this._alphaSpr.alpha=.4,this._popUpSpr.addChild(this._alphaSpr)),a&&this._alphaSpr.on(t.Laya.Event.CLICK,this,this.hidePopUp)):this._alphaSpr&&(this._alphaSpr.visible=!1),this._popUpSpr.addChild(this._popUpContent)}hidePopUp(){this._popUpSpr&&(this._popUpSpr.visible=!1),this._popUpContent&&(this._popUpContent==this._dataViewer?this._popUpContent.visible=!1:this._popUpContent.destroy()),this._popUpSign=null}addDialog(e,n=!0,i=!0,o=!1){this._dialogContent=e,null==this._dialogSpr?(this._dialogSpr=new t.Sprite,t.Laya.stage.addChild(this._dialogSpr)):this._dialogSpr.visible=!0;let a=s.getMobileHeight();n&&(e.x=(t.Laya.stage.width-e.width)/2,e.y=(a-e.height)/2),i?(null==this._alphaDialogSpr&&(this._alphaDialogSpr=new t.Sprite,this._alphaDialogSpr.width=t.Laya.stage.width,this._alphaDialogSpr.height=a,this._alphaDialogSpr.graphics.drawRect(0,0,t.Laya.stage.width,a,"#000000"),this._alphaDialogSpr.alpha=.4,this._alphaDialogSpr.mouseEnabled=!0,this._alphaDialogSpr.mouseThrough=!1,this._dialogSpr.addChild(this._alphaDialogSpr)),o&&this._alphaDialogSpr.on(t.Laya.Event.CLICK,this,this.hideDialog)):this._alphaDialogSpr&&(this._alphaDialogSpr.visible=!1),this._dialogSpr.addChild(this._dialogContent)}hideDialog(){this._dialogSpr&&(this._dialogSpr.visible=!1),this._dialogContent&&(this._dialogContent==this._dataViewer?(this._dialogContent.visible=!1,e.showAllBtn()):this._dialogContent.destroy())}createWxOpenDataViewer(){null==this._dataViewer&&(this._dataViewer=new t.WXOpenDataViewer,this._dataViewer.width=610,this._dataViewer.height=757,this._dataViewer.visible=!1)}showRank(){this._dataViewer.visible=!0,this._dataViewer.postMsg({cmd:"refreshRankList"}),this.addDialog(this._dataViewer,!0,!0,!0),e.hideAllBtn()}}class a extends o{constructor(){super()}onAwake(){super.onAwake(),this.owner.height=t.Laya.stage.height}onEnable(){}onDisable(){}updatePercent(t){this.txt_progress.text="正在加载资源 "+t+"%"}}class r{constructor(){this.isRecover=!1,this._____id=r.modelIdIncrease,r.modelIdIncrease++}setData(t){let e=this.getStruct();if(t instanceof Array&&null!=e)for(let n=0;n<e.length;n++)this[e[n]]=t[n];else for(let e in t)this[e]=t[e]}getStruct(){return null}getSign(){return null==this._sign&&(this._sign=this.__proto__.constructor.name),this._sign}static create(t){let e;return null==s.pools.ModelBase&&(s.pools.ModelBase={sign:"ModelBase",pool:r._pool,createCount:0,recoverCount:0}),s.pools.ModelBase.createCount++,r._pool.length>0?(e=r._pool.pop()).isRecover=!1:e=new r,null!=t&&e.setDataByKey(t),e}recover(){this.isRecover||(null==s.pools.ModelBase&&(s.pools.ModelBase={sign:"ModelBase",pool:r._pool,createCount:0,recoverCount:0}),s.pools.ModelBase.recoverCount++,r._pool.push(this),this.isRecover=!0)}setDataByKey(t){}}r.modelIdIncrease=0,r._pool=[];class l{constructor(){this.spineList={},this.textureList={},this.animationList={},this.modelDelayList={},this.idx=0}static Instance(){return null==l.instance&&(l.instance=new l),l.instance}releaseSpine(e){if(this.spineList[e]){let n=this.spineList[e];for(let t=0;t<n._loadList.length;t++){let e=n.getTexture(n._loadList[t]);e&&(e.disposeBitmap(),e.destroy())}n.destroy(),t.Laya.loader.clearRes(e),this.spineList[e]=null}}loadSpine(e,n){var i=this,s=0,o=function(o){var a=new t.Templet;a.on(t.Event.COMPLETE,i,function(){i.spineList[o]=a,e instanceof Array?++s==e.length&&n.run():n.run()}),a.loadAni(o)};if(e instanceof Array)for(var a=0;a<e.length;a++)o(e[a]);else o(e)}loadTexture(e,n){if(e instanceof Array)for(var i=0;i<e.length;i++)i==e.length-1?t.Texture2D.load(e[i],n):t.Texture2D.load(e[i],null);else t.Texture2D.load(e,n)}loadPNG(e,n){null==t.Laya.loader.getRes(e)?t.Laya.loader.load(e,n,null,"image"):n.run()}getPNG(e){return t.Laya.loader.getRes(e)}createSprite(e,n){let i,s=n||new t.Sprite;return null==t.Laya.loader.getRes(e)?this.loadPNG(e,t.Handler.create(this,function(){i=this.getPNG(e),s.graphics.drawTexture(i),i&&s.size(i.sourceWidth,i.sourceHeight)})):(i=this.getPNG(e),s.graphics.drawTexture(i),i&&s.size(i.sourceWidth,i.sourceHeight)),s}createImg(e,n){return n||(n=new t.Image),this.loadPNG(e,t.Handler.create(this,function(){n.skin=e})),n}loadModel(e,n){t.Laya.loader.getRes(e)&&t.Laya.loader.getRes(e)._children&&t.Laya.loader.getRes(e).getChildAt(0)?n.run():t.Laya.loader.create(e,n)}load(e,n){null==t.Laya.loader.getRes(e)?t.Laya.loader.load(e,n):n.run()}loadJson(e,n){null==t.Laya.loader.getRes(e)?t.Laya.loader.load(e,n,null,t.Loader.JSON):n.run()}loadAtlas(e,n){null==t.Laya.loader.getRes(e)?t.Laya.loader.load(e,n,null,t.Laya.Loader.ATLAS):n.run()}loadAnimation(e,n,i){if(""!=n&&null!=n){if(null!=t.Laya.loader.getRes(e)&&null!=t.Laya.loader.getRes(n))return void i.run()}else if(null!=t.Laya.loader.getRes(e))return void i.run();t.Laya.loader.load(e,t.Handler.create(this,function(){null!=n&&""!=n?t.Laya.loader.load(n,t.Handler.create(this,function(){this.animationList[e]=n,i.run()}),null,t.Loader.ATLAS):i.run()},null,!1),null,t.Loader.JSON)}getSpine(t){return this.spineList[t]}createSpine(e,n,i=!0,s=null){var o;return this.spineList[e]?(o=this.spineList[e].buildArmature(0),null!=n&&o.play(n,i),null!=s&&s.runWith(o)):(o=new t.Skeleton,this.loadSpine(e,t.Handler.create(this,function(){o.init(this.spineList[e],0),null!=n&&o.play(n,i),null!=s&&s.runWith(o)}))),o}getTexture(e,n){let i=t.Laya.loader.getRes(e);i?n.runWith(i):this.loadTexture(e,n)}tryGetTexture(e){let n=t.Laya.loader.getRes(e);return n||null}loadList(t,e,n,i){if(0==t.length)return void i.call(e);let s={id:this.idx,urls:t,caller:e,index:0,onProgress:n,onComplete:i};this.idx++,this.startLoad(s)}startLoad(t){if(t.urls.length<=t.index)return void(null!=t.onComplete&&t.onComplete.call(t.caller));let e=t.urls[t.index];t.index++,null!=t.onProgress&&t.onProgress.call(t.caller,t.index,t.urls.length),this.loadOnce(e,this.startLoad,t)}loadOnce(e,n,i){e instanceof Object&&(e=e.url);let s=e.substr(e.indexOf(".")+1).toLowerCase(),o=t.Handler.create(this,function(t,e,n,i){t.call(e,n)},[n,this,i,e]);switch(s){case"png":-1==e.indexOf("texture/")?this.loadPNG(e,o):this.loadTexture(e,o);break;case"sk":this.loadSpine(e,o);break;case"lh":this.loadModel(e,o);break;case"json":case"lang":this.loadJson(e,o);break;case"atlas":this.loadAtlas(e,o);break;case"ani":this.loadAnimation(e,null,o);break;default:this.load(e,o)}}}l.instance=null;class h extends r{constructor(){super(...arguments),this._quality=1}static getGroup(t){if(null==h._groupCache[t]){let e=[];for(let n=0;n<h.DataSource.group.length;n++){let i=h.DataSource.group[n];-1!=i.indexOf(t)&&e.push(i)}for(let n=0;n<h.DataSource.bank.length;n++){let i=h.DataSource.bank[n];-1!=i.indexOf(t)&&e.push(i)}h._groupCache[t]=e}return h._groupCache[t]}get quality(){return this._quality}set quality(t){t>4&&(t=4),this._quality=t}static create(t){let e;return null==s.pools.MapFontInfo&&(s.pools.MapFontInfo={sign:"MapFontInfo",pool:h._pool,createCount:0,recoverCount:0}),s.pools.MapFontInfo.createCount++,h._pool.length>0?(e=h._pool.pop()).isRecover=!1:e=new h,null!=t&&e.setDataByKey(t),e}get canHeChengGroup(){if(null==h._heChengCiZuObj[this.text]){let t=[];h.DataSource.group.forEach(e=>{-1!=e.indexOf(this.text)&&t.push(e)}),h.DataSource.bank.forEach(e=>{-1!=e.indexOf(this.text)&&t.push(e)}),h._heChengCiZuObj[this.text]=t}return h._heChengCiZuObj[this.text].length>0}get canHeChengGroups(){return this.canHeChengGroup?h._heChengCiZuObj[this.text]:[]}getStructInfos(t=null,e=!0){let n=[];return t==this.id&&0==e?n.push(t.toString()):this.structInfo.split(",").forEach(i=>{if(null==t){if(i==this.id.toString())return;n.push(i)}else{if(e&&i==t.toString())return;-1!=i.split("_").indexOf(t.toString())&&n.push(i)}}),n}get canHeChengFont(){if(null==h._heChengHanZiObj[this.text]){let t=[];h.DataSource.font.forEach(e=>{let n=h.create();n.setDataByValueArr(e),n.getStructInfos(this.id).length>0&&t.push(n)}),h._heChengHanZiObj[this.text]=t}return h._heChengHanZiObj[this.text].length>0}get canHeChengFontInfos(){return this.canHeChengFont?h._heChengHanZiObj[this.text]:[]}getStuntFontEffect(){return this.isStuntFont?(null==this._stuntFontEffect&&(this._stuntFontEffect=l.Instance().createSpine(i.spineUrl+"other_wupinghuanrao_kin_little.sk","animation",!0),this._stuntFontEffect.x=this._stuntFontEffect.y=44,this._stuntFontEffect.scaleX=this._stuntFontEffect.scaleY=1.3),this._stuntFontEffect):null}destroyStuntEffect(){this._stuntFontEffect&&(this._stuntFontEffect.destroy(!0),this._stuntFontEffect=null)}getStruct(){return h.DataSource.font_struct}recover(){this.isRecover||(this._stuntFontEffect&&this._stuntFontEffect.destroy(!0),this._stuntFontEffect=null,null==s.pools.MapFontInfo&&(s.pools.MapFontInfo={sign:"MapFontInfo",pool:h._pool,createCount:0,recoverCount:0}),s.pools.MapFontInfo.recoverCount++,h._pool.push(this),this.isRecover=!0)}setDataByValueArr(t){let e=h.DataSource.font_struct;for(let n=0;n<t.length;n++)e.length>n&&(this[e[n]]=t[n])}setDataByKey(t){let e;if("*"==t.text)e=t;else{let n=h.DataSource.font_struct,i=h.DataSource.font;for(let s=0;s<i.length;s++){let i=h.DataSource.font[s],o=!0;for(let e in t)if(t[e]!=i[n.indexOf(e)]){o=!1;break}if(o){e={};for(let t=0;t<n.length;t++)e[n[t]]=i[t];break}}}null!=e&&this.setData(e)}}h._groupCache={},h._pool=[],h._heChengCiZuObj={},h._heChengHanZiObj={};class d extends t.Script{static setPrefeb(t){d._prefeb=t}onAwake(){for(let t=0;t<this.owner.numChildren;t++){let e=this.owner.getChildAt(t);if(""!=e.name&&-1!=e.name.indexOf("_"))switch(e.name.split("_")[0]){case"list":case"txt":case"img":case"btn":case"progress":this[e.name]=e}}}static getPrefeb(){return this._prefeb}static getSign(){return this.__proto__.constructor.name}static create(){return t.Pool.getItemByCreateFun(d.getSign(),d._prefeb.create,d._prefeb)}recover(){t.Pool.recover(d.getSign(),this)}}class c{static getInstance(t){let e=t.name,n=c._controllerObjs[e];return null==n&&(n=new t,c._controllerObjs[e]=n),n}}c._controllerObjs={},window.ControllerMgr=c;class u{getSign(){return this.__proto__.constructor.name}show(){}close(){}destroy(){}}u._controllerObjs={};class p extends d{constructor(){super(),this.text="d"}onAwake(){super.onAwake(),this.txt_text.text=this.text,this.img_bg.width=this.txt_text.displayWidth+36,this.owner.width=this.img_bg.width}onEnable(){}onDisable(){}}class g extends u{constructor(){super(...arguments),this._labels=[],this._startY=960,this._tipItems=[],this._tipItemStartY=550}get tipSpr(){return this._tipSpr}init(){this._tipSpr=new t.Sprite,this._tipSpr.name="TipSpr",t.Laya.stage.addChild(this._tipSpr),t.Laya.loader.load("prefab/TipItem.json",t.Laya.Handler.create(this,this.onLoadTipItemComplete))}onLoadTipItemComplete(){this._tipItemPrefab=new t.Prefab,this._tipItemPrefab.json=t.Laya.loader.getRes("prefab/TipItem.json")}showLeftBottomTip(e){let n=new t.Label;n.color="#204800",n.text=e,n.font="SimHei",n.fontSize=30,n.anchorY=1,n.y=this._startY,this._tipSpr.addChild(n),this._labels.push(n),this.sortLabels(),t.Laya.timer.once(1e3,this,function(){t.Tween.to(n,{alpha:0},300)}),t.Laya.timer.once(1300,this,function(){this._labels.splice(this._labels.indexOf(n),1),t.Laya.timer.clearAll(n),n.destroy(!0)})}showCenterBottomTip(e){let n=t.Browser.window.wx.getSystemInfoSync(),i=n.screenWidth,s=n.screenHeight,o=new t.Label;o.color="#204800",o.text=e,o.font="SimHei",o.fontSize=35,o.anchorY=1,o.y=s/2+150,o.x=i/2-80,this._tipSpr.addChild(o),this._labels.push(o),this.sortLabels(),t.Laya.timer.once(1e3,this,function(){t.Tween.to(o,{alpha:0},300)}),t.Laya.timer.once(2300,this,function(){this._labels.splice(this._labels.indexOf(o),1),t.Laya.timer.clearAll(o),o.destroy(!0)})}sortLabels(){for(let e;e<this._labels.length;e++){let n=this._labels[e],i=this._startY-40*e;t.Tween.to(n,{y:i},100)}}showTip(e){if(null!=this._tipItemPrefab){let n=t.Pool.getItemByCreateFun("TipItem",this._tipItemPrefab.create,this._tipItemPrefab);n.getComponent(p).text=e,this._tipSpr.addChild(n),n.x=(t.Laya.stage.width-n.width)/2,n.y=this._tipItemStartY-60,this._tipItems.push(n),this.sortTipItems(),t.Laya.timer.once(1e3,this,function(){t.Tween.to(n,{alpha:0},300)}),t.Laya.timer.once(1300,this,function(){this._tipItems.splice(this._tipItems.indexOf(n),1),t.Laya.timer.clearAll(n),n.destroy(!0)})}}sortTipItems(){for(let e=0;e<this._tipItems.length;e++){let n=this._tipItems[e],i=this._tipItemStartY-60*(this._tipItems.length-e);t.Tween.to(n,{y:i},100)}}}window.TipController=g;class f extends r{static create(t){let e;return null==s.pools.MapStarInfo&&(s.pools.MapStarInfo={sign:"MapStarInfo",pool:f._pool,createCount:0,recoverCount:0}),s.pools.MapStarInfo.createCount++,f._pool.length>0?(e=f._pool.pop()).isRecover=!1:e=new f,null!=t&&e.setDataByKey(t),e}getStruct(){return h.DataSource.star_struct}recover(){this.isRecover||(null==s.pools.MapStarInfo&&(s.pools.MapStarInfo={sign:"MapStarInfo",pool:f._pool,createCount:0,recoverCount:0}),s.pools.MapStarInfo.recoverCount++,f._pool.push(this),this.isRecover=!0)}setDataByKey(t){let e,n=this.getStruct(),i=h.DataSource.star;for(let s=0;s<i.length;s++){let o=i[s],a=!0;for(let e in t)if(t[e]!=o[n.indexOf(e)]){a=!1;break}if(a){e={};for(let t=0;t<n.length;t++)e[n[t]]=o[t];break}}null!=e&&this.setData(e)}}f._pool=[];class _ extends r{constructor(){super(...arguments),this.name="test",this.url="http://cdn.duitang.com/uploads/item/201410/08/20141008150015_dP8yJ.thumb.700_0.jpeg",this.wannengUseTimes=4,this.guideUseTimes=4,this.comeBackTimes=1}getStarInfo(t){let e;return e=t<1200?0:t<2e3?1:t<3e3?2:t<4e3?3:t<5e3?4:t<6e3?5:t<7e3?6:t<8e3?7:t<9e3?8:t<1e4?9:10,null!=this._starInfo&&this._starInfo.star_num==e||(this._starInfo=f.create(),this._starInfo.star_num!=e&&this._starInfo.setDataByKey({star_num:e})),this._starInfo}}class m extends u{constructor(){super(...arguments),this.myPlayerInfo=new _}}class y{static login(e){let n=t.Browser.window.wx.getSystemInfoSync(),i=n.screenWidth,s=n.screenHeight;t.Browser.window.wx.getSetting({success(n){if(console.log(n.authSetting),n.authSetting["scope.userInfo"])console.log("用户已授权"),t.Browser.window.wx.getUserInfo({success(t){console.log(t),e.runWith(!0)}});else{console.log("用户未授权");let n=t.Browser.window.wx.createUserInfoButton({type:"text",text:"",style:{left:0,top:0,width:i,height:s,backgroundColor:"#00000000",color:"#ffffff",fontSize:20,textAlign:"center",lineHeight:s}});n.onTap(t=>{t.userInfo?(console.log("用户授权:",t),e.runWith(!0),n.destroy()):(console.log("用户拒绝授权:",t),e.runWith(!1))})}}})}static update(e){const n=t.Browser.window.wx.getUpdateManager();n.onCheckForUpdate(function(t){console.log("新版本信息："+t.hasUpdate)}),n.onUpdateReady(function(){t.Browser.window.wx.showModal({title:"更新提示",content:"新版本已经准备好，是否重启应用？",success(t){t.confirm&&n.applyUpdate()}})}),n.onUpdateFailed(function(){console.log("新版本信息下载失败！！！！！")})}static getIsBangs(e){t.Browser.window.wx.getSystemInfo({success:function(t){y.wxinfo=t,console.log("获取系统信息-----success:"+t)},fail:function(t){console.log("获取系统信息-----fail:"+t)},complete:function(n){console.log("获取系统信息-----complete:windowHeight："+n.windowHeight+" windowWidth:"+n.windowWidth);let i=n.windowHeight/n.windowWidth>t.Laya.stage.designHeight/t.Laya.stage.designWidth?"true":"false";e.runWith(i)}})}static shareWebPage(e){y.shareWebHandler=e,t.Browser.window.tt?t.Browser.window.tt.shareAppMessage({title:"夏日跳水大作战",desc:"#夏日跳水大作战 #抖音小游戏",imageUrl:"miniImg/miniShare.png",success(){console.log("分享成功"),y.shareWebHandler.runWith("true")},fail(t){console.log("分享失败"),y.shareWebHandler.runWith("false")}}):t.Browser.window.wx.shareAppMessage({title:"夏日跳水大作战",desc:"夏日跳水大作战，搞笑动作等你来开发！",imageUrl:"miniImg/miniShare.png"})}static onShareAppMessage(){t.Browser.window.wx.onShareAppMessage(function(){return{title:"夏日跳水大作战，搞笑动作等你来开发！",biliContent:"#夏日跳水大作战#",imageUrl:"miniImg/miniShare.png"}})}static showBanner(){if(!t.Browser.onTTMiniGame)return;y.bannerVisible=!0;let e=t.Browser.window.wx.getSystemInfoSync(),n=e.screenWidth,i=e.screenHeight;y.bannerAd&&(y.bannerAd.destroy(),y.bannerAd=null);let s=t.Browser.window.tt?"f7iibhjbf251ui7u79":"adunit-3bf2554b5207e425";y.bannerAd=t.Browser.window.tt.createBannerAd({adUnitId:s,style:{left:(n-95*n/100)/2,top:i-120,width:95*n/100}}),y.bannerAd.onLoad(function(){y.bannerVisible&&y.bannerAd.show().then(()=>{console.log("广告显示成功")}).catch(t=>{console.log("广告组件出现问题",t)})}),y.bannerAd.onError(t=>{console.log(t)}),y.bannerAd.onResize(t=>{y.bannerAd.style.top=y.wxinfo.screenHeight-t.height,y.bannerAd.style.left=(y.wxinfo.screenWidth-t.width)/2})}static hideBanner(){t.Browser.onTTMiniGame&&(y.bannerVisible=!1,y.bannerAd&&(y.bannerAd.destroy(),y.bannerAd=null))}static loadRewardedVideo(e){y.loadVideoComplete=e,y.rewardedvideo?y.rewardedvideo.load():(y.rewardedvideo=t.Browser.window.wx.createRewardedVideoAd({adUnitId:"adunit-a7bced9f18d8a7bb"}),y.rewardedvideo.onLoad(()=>{console.log("激励视频 广告加载成功"),y.loadVideoComplete.runWith("true")}),y.rewardedvideo.onError(t=>{console.log(t)}))}static showRewardedVideo(e){if(t.Browser.onTTMiniGame){if(y.showAdVideoHandler=e,!y.rewardedvideo){let e=t.Browser.window.tt?"1j4221j5gf9jd1gllf":"adunit-a30e0ad0d9697dfd";y.rewardedvideo=t.Browser.window.wx.createRewardedVideoAd({adUnitId:e}),y.rewardedvideo.onClose(t=>{(t&&t.isEnded||void 0===t)&&(console.log("激励视频播放完成"),y.showAdVideoHandler.runWith("true"))}),y.rewardedvideo.onError(t=>{console.log(t)})}y.rewardedvideo.show().catch(t=>{y.rewardedvideo.load().then(()=>{y.rewardedvideo.show()}),console.log("show激励视频"+t)})}else e.run()}static showInterstitialAd(e=null){if(t.Browser.onTTMiniGame){if(y.interstitialAdHandler=e,t.Browser.window.tt){const e="Douyin"===t.Browser.window.tt.getSystemInfoSync().appName;if(console.log("app name",t.Browser.window.tt.getSystemInfoSync().appName),!e)return void y.interstitialAdHandler.runWith("false")}if(!y.interstitialAd){let e=t.Browser.window.tt?"1b2m7lpbgi51jajhce":"adunit-a30e0ad0d9697dfd";y.interstitialAd=t.Browser.window.wx.createInterstitialAd({adUnitId:e}),y.interstitialAd.onClose(t=>{console.log("插屏播放完成"),y.interstitialAdHandler&&y.interstitialAdHandler.runWith("true")}),y.interstitialAd.onError(t=>{console.log(t),y.interstitialAdHandler.runWith("false")})}y.interstitialAd.show().catch(t=>{console.log("show插屏广告"+t),y.interstitialAdHandler.runWith("false")})}else y.interstitialAdHandler.runWith("false")}static showGameIconAd(){if(t.Browser.window.wx){if(!y.cconAdobjArr){y.cconAdobjArr=[];for(let t=0;t<5;t++){var e={appNameHidden:!1,color:"#ffffff"};e.top=y.wxinfo.screenHeight/2-15,y.cconAdobjArr.push(e)}}!y.iconAd&&t.Browser.window.wx.createGameIcon&&(y.iconAd=t.Browser.window.wx.createGameIcon({adUnitId:"PBgAAfCNfP3TjmkM",count:5,style:y.cconAdobjArr})),y.iconAd&&y.iconAd.load().then(()=>{y.iconAd.show()}).catch(t=>{console.error(t),console.log("showGameIconAd Error:"+t)})}}static showGamePortal(){t.Browser.window.wx.createGamePortal&&(y.portalAd=t.Browser.window.wx.createGamePortal({adUnitId:"PBgAAet6sZW2CQug"})),y.portalAd&&y.portalAd.load().then(()=>{y.portalAd.show()}).catch(t=>{t.errCode,console.error(t)})}}y.bannerVisible=!1,y.cconAdobjArr=[],y.portalAd=null;class w extends d{constructor(){super()}onAwake(){if(super.onAwake(),this.owner.height=t.Laya.stage.height,"wx"==s.platform){let n=window.Laya.MiniAdpter.window.screen.availWidth/640,i=s.getMobileHeight(),o=window.Laya.MiniAdpter.window.screen.availHeight*(i/t.Laya.stage.height)/i,a=t.Browser.window.wx.createUserInfoButton({type:"image",image:"btn_startGame.png",style:{left:this.btn_startGame.x*n,top:this.btn_startGame.y*o,width:this.btn_startGame.width*n,height:this.btn_startGame.height*o,lineHeight:40,color:"#ffffff",textAlign:"center",fontSize:16,borderRadius:4}});a.onTap(t=>{console.log(t),c.getInstance(m).myPlayerInfo.name=t.userInfo.nickName,this.handler.run(),a.destroy()}),this.btn_startGame.destroy(),this.btn_startGame=a,e.addBtn(this.btn_startGame)}else this.btn_startGame.on(t.Event.CLICK,this,function(){this.handler.run()});this.btn_showRank.on(t.Event.CLICK,this,function(){"wx"==s.platform?this.onShowRank.run():c.getInstance(g).showTip("尽情期待")}),this.btn_share.on(t.Event.CLICK,this,function(){"wx"==s.platform?t.Browser.window.wx.shareAppMessage({title:"发现有个有趣的游戏",imageUrl:"https://mmocgame.qpic.cn/wechatgame/iaUVuxArE9L9G28F6XrxKAIEtJOs9x1Ycm2MYmC2Uz5T9O4RLq0ejvG3ic2KlUBiaVf/0",imageUrlId:"NelenHPLRXK1-AWENn0aZw"}):c.getInstance(g).showTip("尽情期待")})}onEnable(){"tt"==s.platform&&y.showBanner()}onDisable(){"wx"==s.platform?(e.removeBtn(this.btn_startGame),this.btn_startGame.destroy(!0)):this.btn_startGame.offAll(),"tt"==s.platform&&y.hideBanner()}}class S extends d{constructor(){super(),this.font="",this.quality=1,this.colorArr=["blue","red","puple","yellow"],this._effects=[]}addEffect(t){null!=t&&(this.owner.addChild(t),this._effects.push(t))}clearEffects(){this._effects.forEach(t=>{this.owner.removeChild(t)}),this._effects=[]}onUpdate(){let t=this.owner.getChildByName("img_bg");null!=this.font?(this.owner.getChildByName("txt").text=this.font,t.visible=!0,t.skin="map/img_"+this.getQualitySign()+"GridBg.png"):(this.owner.getChildByName("txt").text="",t.visible=!1)}getQualitySign(){return this.colorArr[this.quality-1]}onReset(){this.quality=1}onDisable(){this.recover()}playHeChengEffect(){let e=l.Instance().createSpine(i.spineUrl+"other_taozhuangxitong1.sk","animation",!1);e.x=e.y=44,e.scaleX=e.scaleY=1.7,this.owner.addChild(e),e.on(t.Event.STOPPED,this,function(t){t.destroy()},[e])}reset(){this.quality=1,this.clearEffects()}}class x extends d{constructor(){super()}onAwake(){super.onAwake(),this.owner.height=t.Laya.stage.height,this.txt_score.text=this.score.toString(),this.btn_home.clickHandler=t.Handler.create(this,function(){this.showHomeHandler.run()},null,!1),this.btn_tryAgain.clickHandler=t.Handler.create(this,function(){this.restartHandler.run()},null,!1),this.btn_showAd.clickHandler=t.Handler.create(this,function(){"tt"==s.platform?y.showRewardedVideo(t.Handler.create(this,this.onShowAdComple)):"android"==s.platform&&this.showAdHandler.run()},null,!1)}onShowAdComple(){this.showAdHandler.run()}onEnable(){this.comeBackTime<1&&(this.btn_showAd.visible=!1),y.showBanner()}onDisable(){this.btn_home.offAll(),this.btn_tryAgain.offAll(),y.hideBanner()}}class I{static playXiaoChuEffect(){null!=t.Laya.loader.getRes(i.soundUrl+"xiaochu.wav")&&t.Laya.SoundManager.playSound(i.soundUrl+"xiaochu.wav")}static playHeChengEffect(){null!=t.Laya.loader.getRes(i.soundUrl+"hecheng.wav")&&t.Laya.SoundManager.playSound(i.soundUrl+"hecheng.wav")}static playTeJiEffect(){null!=t.Laya.loader.getRes(i.soundUrl+"teji.wav")&&t.Laya.SoundManager.playSound(i.soundUrl+"teji.wav")}static playXiaHuaEffect(){null!=t.Laya.loader.getRes(i.soundUrl+"xiahua.wav")&&t.Laya.SoundManager.playSound(i.soundUrl+"xiahua.wav")}static playYiDongEffect(){null!=t.Laya.loader.getRes(i.soundUrl+"yidong.wav")&&t.Laya.SoundManager.playSound(i.soundUrl+"yidong.wav")}static getSoundVolume(){return I._soundVolume}static setSoundVolume(e=.2){Number.isNaN(e)&&(e=.2),I._soundVolume=e,t.Laya.SoundManager.setSoundVolume(e),t.Laya.LocalStorage.setItem("soundVolume",(100*e).toString())}static init(){I.setSoundVolume(parseInt(t.Laya.LocalStorage.getItem("soundVolume"))/100)}}class F{static init(){F.gameRecorder=t.Browser.window.tt.getGameRecorderManager(),F.gameRecorder.onStart(()=>{console.log("录屏开始")}),F.gameRecorder.onStop(t=>{console.log("录屏结束",t.videoPath),F.videoPath=t.videoPath}),F.gameRecorder.onInterruptionBegin(t=>{console.log("监听录屏中断开始",t.videoPath)}),F.gameRecorder.onInterruptionEnd(t=>{console.log("监听录屏中断结束",t.videoPath)}),F.gameRecorder.onError(t=>{console.log("监听录屏错误",t.videoPath)})}static startGameRecorder(){console.log("...点击开始了"),F.gameRecorder?F.gameRecorder.start({duration:300}):(F.init(),F.gameRecorder.start({duration:300}))}static pauseGameRecorder(){console.log("录屏pause"),F.gameRecorder.pause()}static resumeGameRecorder(){console.log("录屏resume"),F.gameRecorder.resume()}static stopGameRecorder(){console.log("停止了录屏"),F.gameRecorder&&(console.log("停止了录屏11111"),F.gameRecorder.stop())}static shareGameRecorder(e){if(""==F.videoPath)return console.log("上局游戏暂未录制！"),void e.runWith("false");console.log("分享录制 videoPath："+F.videoPath),t.Browser.window.tt.shareAppMessage({channel:"video",title:"趣味汉字",desc:"#趣味汉字 #抖音小游戏",extra:{videoPath:F.videoPath,videoTopics:["#趣味汉字","#抖音小游戏"]},success:()=>{console.log("录屏分享成功"),e.runWith("true")},fail:t=>{console.log("录屏分享失败:"+t.errMsg),t.errMsg.indexOf("too short")>=0?e.runWith("short"):e.runWith("false")}})}}F.videoPath="";class b extends d{constructor(){super()}onAwake(){super.onAwake(),this.btn_home.clickHandler=t.Handler.create(this,function(){this.showHomeHandler.run()},null,!1),this.btn_tryAgain.clickHandler=t.Handler.create(this,function(){"wx"==s.platform?(this.restartHandler.runWith(1),t.Browser.window.wx.shareAppMessage({title:"发现有个有趣的游戏",imageUrl:"https://mmocgame.qpic.cn/wechatgame/iaUVuxArE9L9G28F6XrxKAIEtJOs9x1Ycm2MYmC2Uz5T9O4RLq0ejvG3ic2KlUBiaVf/0",imageUrlId:"NelenHPLRXK1-AWENn0aZw"})):this.restartHandler.run()},null,!1),this.btn_share.clickHandler=t.Handler.create(this,function(e){"wx"==s.platform?t.Browser.window.wx.shareAppMessage({title:"发现有个有趣的游戏",imageUrl:"https://mmocgame.qpic.cn/wechatgame/iaUVuxArE9L9G28F6XrxKAIEtJOs9x1Ycm2MYmC2Uz5T9O4RLq0ejvG3ic2KlUBiaVf/0",imageUrlId:"NelenHPLRXK1-AWENn0aZw"}):"tt"==s.platform?(F.stopGameRecorder(),F.shareGameRecorder(t.Handler.create(this,this.onShareGameRecordComple))):c.getInstance(g).showTip("尽情期待")},null,!1),this.btn_close.clickHandler=t.Handler.create(this,function(t){this.onCloseHandler.run()},null,!1),this.btn_music.on(t.Event.MOUSE_DOWN,this,this.onDragMouseDown),this.btn_effect.on(t.Event.MOUSE_DOWN,this,this.onDragMouseDown),this.refresh()}onDragMouseDown(e){this._dragTarget=e.currentTarget,t.Laya.stage.on(t.Event.MOUSE_UP,this,this.onStageMouseUp2),t.Laya.stage.on(t.Event.MOUSE_MOVE,this,this.onStageMouseMove2)}onStageMouseUp2(e){this._dragTarget=null,t.Laya.stage.off(t.Event.MOUSE_UP,this,this.onStageMouseUp2),t.Laya.stage.off(t.Event.MOUSE_MOVE,this,this.onStageMouseMove2)}onStageMouseMove2(e){let n,i=new t.Point(e.stageX,e.stageY);this._dragTarget==this.btn_effect&&(n=this.progress_effect);let s=(i=this._dragTarget.parent.globalToLocal(i)).x-n.x;s<0?s=0:s>346&&(s=346),n.width=s;let o=s/346;n.width=o,n==this.progress_effect&&I.setSoundVolume(o),this.refresh()}refresh(){this.progress_effect.width=346*I.getSoundVolume(),this.btn_effect.x=this.progress_effect.x+this.progress_effect.width}onEnable(){y.showBanner()}onDisable(){this.btn_home.offAll(),this.btn_tryAgain.offAll(),this.btn_share.offAll(),y.hideBanner()}onShareGameRecordComple(e){"true"!=e&&c.getInstance(g).showCenterBottomTip("录屏时长不足3秒,请重新录制"),console.log("...分享了完成了",e),"tt"==s.platform&&t.Laya.timer.once(500,this,function(){F.startGameRecorder()})}}class C extends t.Script{static showVedioAd(e){var n,i=t.Browser.window.conchConfig.getOS();"Conch-ios"==i?n=t.Browser.window.PlatformClass.createClass("JSBridge"):"Conch-android"==i&&(n=t.Browser.window.PlatformClass.createClass("demo.JSBridge")),"Conch-ios"==i?n.callWithBack(function(t){e()},"showVedioAdCallBk:"):"Conch-android"==i&&n.callWithBack(function(t){e()},"showVedioAdCallBk")}static showBannerAd(e){var n,i=t.Browser.window.conchConfig.getOS();"Conch-ios"==i?n=t.Browser.window.PlatformClass.createClass("JSBridge"):"Conch-android"==i&&(n=t.Browser.window.PlatformClass.createClass("demo.JSBridge")),"Conch-ios"==i?n.call("setBannerAdVisible:",e):"Conch-android"==i&&n.call("setBannerAdVisible",e)}}var L;!function(t){t[t.End=0]="End",t[t.Pause=1]="Pause",t[t.Playing=2]="Playing",t[t.init=3]="init",t[t.EffectPause=4]="EffectPause"}(L||(L={}));class E extends o{constructor(){super(),this._fonts=[],this._sysDropingFontInfos=[],this._sysDispelFontInfoStack=[],this._startPoint=new t.Point(2,0),this._maxTickTime=75,this._sysTickTime=0,this._maxSysTickTime=16,this._words=[],this._splitFontWords=[],this._splitGroupWords=[],this._minWordsLength=5,this._isMouseDown=!1,this._isQuickDrop=!1,this._score=0,this._debugMode=!1,this._debugFonts=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"氵",null,"穴","宀",null],this._debugDropFonts=["工","工"],this._guideDropFonts=[],this._cacheProperties=["heCiSplitTimes","heCizuRate","ciZuRate","_score","_popularGroup","_guideRate","buShouRate"],this._stuntFontsCheckArr1=[],this._stuntFontsCheckArr2=[],this._checkIds=[],this._guideImgs={},this._guideRate=0,this.heCiSplitTimes=1,this.heCizuRate=40,this.hanZiRate=60,this.ciZuRate=60,this.buShouRate=0,this._playerEffectInd=0}onAwake(){super.onAwake(),this.owner.height=t.Laya.stage.height,s.platform,s.hadGuidanceHz()||(this._guideDropFonts=["讠","成","言","亻","文","日","月"],s.setGuidanceHz(!0)),this.list_grids.renderHandler=t.Handler.create(this,this.onGridRender,null,!1),this._myPlayerInfo=c.getInstance(m).myPlayerInfo,this.btn_pauseOrStart.on(t.Event.CLICK,this,this.onPauseOrStartMouseEvent),this.btn_setting.on(t.Event.CLICK,this,this.onSettingMouseEvent),this.btn_point.on(t.Event.CLICK,this,this.onPointMouseEvent),this.btn_wanneng.on(t.Event.CLICK,this,this.onWannengMouseEvent),this.btn_vedio.on(t.Event.CLICK,this,this.onStopMouseEvent),this.btn_vedio1.on(t.Event.CLICK,this,this.onGoShareMouseEvent),s.hadGuidance()||(this.btn_point.visible=!1),"tt"==s.platform&&t.Laya.timer.once(500,this,function(){F.startGameRecorder()}),this.changeGameStatue(L.init),this.refresh()}onStopMouseEvent(t){console.log("...点击了停止录屏"),this.btn_vedio.visible=!1,this.btn_vedio.disabled=!0,this.btn_vedio1.visible=!0,this.btn_vedio1.disabled=!1,F.stopGameRecorder()}onGoShareMouseEvent(e){this.btn_vedio1.visible=!1,this.btn_vedio1.disabled=!0,F.shareGameRecorder(t.Handler.create(this,this.onShareGameRecordComple))}onShareGameRecordComple(e){"true"!=e&&c.getInstance(g).showCenterBottomTip("录屏时长不足3秒,请重新录制"),console.log("...分享了完成了",e),this.btn_vedio.visible=!0,this.btn_vedio.disabled=!1,t.Laya.timer.once(500,this,function(){F.startGameRecorder()})}onWannengMouseEvent(e){y.showRewardedVideo(t.Handler.create(this,this.onWannengComple))}onWannengComple(){if(this._myPlayerInfo.wannengUseTimes>0){let t=()=>{this.changeGameStatue(L.Playing),this._nextDropingFontInfo=h.create({text:"*"}),this._myPlayerInfo.wannengUseTimes--,this.refresh()};s.isNative?(this.changeGameStatue(L.Pause),C.showVedioAd(t)):t()}else;}onCPComple(t){let e=()=>{this.changeGameStatue(L.Playing),console.log("cha ping data",t),"true"==t&&(this._nextDropingFontInfo=h.create({text:"*"})),this.refresh()};s.isNative?(this.changeGameStatue(L.Pause),C.showVedioAd(e)):e()}onPointMouseEvent(e){y.showRewardedVideo(t.Handler.create(this,this.onPointComple))}onPointComple(){if(!(this._myPlayerInfo.guideRemainTimes>0))if(this._myPlayerInfo.guideUseTimes>0){let t=()=>{this.changeGameStatue(L.Playing),this._myPlayerInfo.guideRemainTimes=3,this._myPlayerInfo.guideUseTimes--,this.refresh()};s.isNative?(this.changeGameStatue(L.Pause),C.showVedioAd(t)):t()}else;}onSettingMouseEvent(t){this.changeGameStatue(L.Pause),this.showGameSetting()}onPauseOrStartMouseEvent(t){if(this._gameState==L.Pause)this.changeGameStatue(L.Playing);else{let t="";for(let e=0;e<this.list_grids.repeatY;e++){for(let n=0;n<this.list_grids.repeatX;n++)null==this._fonts[n][e]?t+="null,":t+="'"+this._fonts[n][e].text+"',";t+="\n"}console.log(t),this.changeGameStatue(L.Pause)}}showStartGame(){let e=t.Pool.getItemByCreateFun("StartGame",this.prefab_startGame.create,this.prefab_startGame),n=e.getComponent(w);n.handler=t.Handler.create(this,this.changeGameStatue,[L.Playing],!1),n.onShowRank=t.Handler.create(this,this.showRank,null,!1),this.addPopUp("StartGame",e,!1,!1,!1)}showGameResult(){let e=t.Pool.getItemByCreateFun("GameResult",this.prefab_gameResult.create,this.prefab_gameResult),n=e.getComponent(x),i={wxgame:{score:this._score,update_time:Date.now()},score:this._score};this._dataViewer.postMsg({cmd:"wx.setUserCloudStorage",data:i}),n.comeBackTime=this._myPlayerInfo.comeBackTimes,n.score=this._score,n.showHomeHandler=t.Handler.create(this,this.changeGameStatue,[L.init],!1),n.restartHandler=t.Handler.create(this,this.restart,null,!1),n.showAdHandler=t.Handler.create(this,this.onShowAd,null,!1),this.addPopUp("GameResult",e,!1,!1,!1)}showGameSetting(){let e=t.Pool.getItemByCreateFun("GameSetting",this.prefab_gameSetting.create,this.prefab_gameSetting),n=e.getComponent(b);n.onCloseHandler=t.Handler.create(this,this.changeGameStatue,[L.Playing],!1),n.showHomeHandler=t.Handler.create(this,this.changeGameStatue,[L.init],!1),n.restartHandler=t.Handler.create(this,this.restart,null,!1),this.addPopUp("gameSetting",e,!1,!1,!1)}onShowAd(){"android"==s.platform?C.showVedioAd(()=>{this.continueAfterAd()}):(s.platform,this.continueAfterAd())}continueAfterAd(){this.hidePopUp(),I.playXiaoChuEffect(),this.playEffectInc();let e=0,n=0;for(let t=this.list_grids.repeatY;t>this.list_grids.repeatY-6;t--)for(let n=0;n<this.list_grids.repeatX;n++){let i=this.getFontScript(n,t);i&&i.playHeChengEffect();let s=this.getFontInfo(n,t);null!=s&&(e++,this.dispelFont(s),s.isStuntFont&&this._stuntFontsCheckArr2.push({fontInfo:s,id:s.id}))}n+=10*e,this._myPlayerInfo.comeBackTimes--,this._score+=n,t.Laya.timer.once(1100,this,function(){this.setDispelText("*"),this.renderGridList(),this.updateScore(),this.setStar(this._myPlayerInfo.getStarInfo(this._score).star_num)}),t.Laya.timer.once(1400,this,function(){this.endEffectInc()})}restart(){localStorage.setItem("StorageVersion",null),localStorage.setItem("CacheData_1",null),this._gameState=L.End,this.changeGameStatue(L.Playing)}changeGameStatue(t,e=-1){switch(t){case L.End:localStorage.setItem("CacheData_1",null),this.showGameResult(),s.isNative&&C.showBannerAd(!0);break;case L.Playing:if(s.isNative&&C.showBannerAd(!1),y.hideBanner(),this.btn_pauseOrStart.skin="map/btn_pause.png",this.hidePopUp(),this._gameState!=L.Pause&&this._gameState!=L.EffectPause){let t;try{t=this.restoreAll()}catch(e){localStorage.setItem("CacheData_1",null),t=!1}if(!t){this._score=0;for(let t=0;t<this.list_grids.repeatX;t++)for(let e=0;e<this.list_grids.repeatY;e++)if(null==this._fonts[t]&&(this._fonts[t]=[]),this._debugMode){let n=this._debugFonts[t+5*e];if(null==n)this._fonts[t][e]=null;else{let i=h.create({text:n});i.x=t,i.y=e,this._fonts[t][e]=i}}else this._fonts[t][e]=null;this._words=[],this._popularGroup=null,this._sysDispelFontInfoStack=[],this._sysDropingFontInfos=[],this._splitFontWords=[],this._splitGroupWords=[],this._dropingFontInfo=null,this._nextDropingFontInfo=null,this.heCiSplitTimes=0,this.heCizuRate=10,this.hanZiRate=10,this.ciZuRate=10,this._myPlayerInfo.wannengUseTimes=4,this._myPlayerInfo.guideUseTimes=4,this._myPlayerInfo.comeBackTimes=1,this.refresh(),this.renderGridList()}}break;case L.Pause:this.btn_pauseOrStart.skin="map/btn_start.png";break;case L.EffectPause:break;case L.init:this.showStartGame(),s.isNative&&C.showBannerAd(!0)}this._gameState=t,-1!=e&&this.changeGameStatue(e)}onGridRender(t,e){let n=t.dataSource,i=t.getComponent(S);null==n?(i.font=null,i.clearEffects()):(i.font=n.text,i.addEffect(n.getStuntFontEffect()),i.quality=n.quality)}onStarRender(t,e){let n=t.dataSource;t.skin=n?"map/img_star.png":"map/img_starBg.png"}onMouseDown(){this._gameState==L.Playing&&(this._mouseDownPoint=new t.Point(t.Laya.stage.mouseX,t.Laya.stage.mouseY),this._isQuickDrop=!1)}onMouseUp(){if(this._gameState==L.Playing){if(null==this._mouseDownPoint)return;let e=Math.abs(t.Laya.stage.mouseX-this._mouseDownPoint.x),n=t.Laya.stage.mouseY-this._mouseDownPoint.y;e>10?n>2.5*e?(this._isQuickDrop=!0,I.playXiaHuaEffect()):(this.moveDropingFont(t.Laya.stage.mouseX<this._mouseDownPoint.x),I.playYiDongEffect()):n>25&&(this._isQuickDrop=!0,I.playXiaHuaEffect()),this._mouseDownPoint=null}}onEnable(){}onDisable(){this._gameState==L.Playing&&this.changeGameStatue(L.Pause)}getGuideSpeedRate(){let t=100;return s.hadGuidance()||this._score<1500&&(t=120),t}onUpdate(){if(this._gameState==L.Playing){let t=!1;if(this.updatePopularGroup(),this._sysDropingFontInfos.length>0)if(this._sysTickTime>0)this._sysTickTime--;else{this._sysTickTime=this._maxSysTickTime;this._sysDropingFontInfos.length==this._sysDispelFontInfoStack.length?(this._sysDropingFontInfos=[],this.invokeStuntFont()||(this.dispelCiZu(this._sysDispelFontInfoStack),this._sysDispelFontInfoStack.forEach(t=>{this.getFontInfo(t.x,t.y)==t&&this.dispel(t.x,t.y)}),this.checkSysDropFonts(),this._sysDispelFontInfoStack=[])):(t=!0,this._sysDropingFontInfos.forEach(e=>{-1==this._sysDispelFontInfoStack.indexOf(e)&&(null==this._fonts[e.x][e.y+1]&&e.y+1<this.list_grids.repeatY?this.changeDropFontTo(e.x,e.y+1,e):(this._sysDispelFontInfoStack.push(e),t=!0))}))}else if(this._score>1200&&0==this.btn_point.visible&&(this.btn_point.visible=!0),this._tickTime>0)this._isQuickDrop&&this._tickTime>1&&(this._tickTime=1),this._tickTime--;else if(this._tickTime=(100-this._myPlayerInfo.getStarInfo(this._score).speed_rate)*this._maxTickTime/100*this.getGuideSpeedRate()/100,this._score>1e3&&s.setGuidance(!0),null==this._dropingFontInfo){if(this._isQuickDrop=!1,null!=this._fonts[this._startPoint.x][this._startPoint.y])return void this.changeGameStatue(L.End);null!=this._nextDropingFontInfo&&"*"==this._nextDropingFontInfo.text?(this._dropingFontInfo=h.create({text:"*"}),this._dropingFontInfo.isStuntFont=!1,this._nextDropingFontInfo=null):(this.randomNextFont(),this._dropingFontInfo=h.create({id:this._nextDropingFontInfo.id}),this._dropingFontInfo.isStuntFont=this._nextDropingFontInfo.isStuntFont),this.guideToGrid(),this.setDispelText(this._dropingFontInfo.text),this.updateNextDropingFont(),this._dropingFontInfo.x=this._startPoint.x,this._dropingFontInfo.y=this._startPoint.y,this._fonts[this._dropingFontInfo.x][this._dropingFontInfo.y]=this._dropingFontInfo,t=!0,this.cacheAll()}else if(this._isQuickDrop&&(this._tickTime=1),null!=this._dropingFontInfo){if(null==this._fonts[this._dropingFontInfo.x][this._dropingFontInfo.y+1]&&this._dropingFontInfo.y+1<this.list_grids.repeatY)this.changeDropFontTo(this._dropingFontInfo.x,this._dropingFontInfo.y+1,this._dropingFontInfo);else{this._mouseDownPoint=null,this.destroyGuideImgs();let t,e=!1;1==(t=this.dispelCiZu([this._dropingFontInfo]))&&(e=!0),1==(t=this.dispel(this._dropingFontInfo.x,this._dropingFontInfo.y))&&(e=!0),this._dropingFontInfo=null}t=!0}t&&this.renderGridList()}}getAllFonts(){let t=[];for(let e=0;e<this._fonts.length;e++)for(let n=this._fonts[0].length-1;n>=0;n--)null!=this._fonts[e][n]&&t.push(this._fonts[e][n]);return t}cacheAll(){let e={};this._cacheProperties.forEach(t=>{e[t]=this[t]}),e.guideRemainTimes=this._myPlayerInfo.guideRemainTimes,e.guideUseTimes=this._myPlayerInfo.guideUseTimes,e.wannengUseTimes=this._myPlayerInfo.wannengUseTimes,e.comeBackTimes=this._myPlayerInfo.comeBackTimes,e._wordTexts=[],this._words.forEach(t=>{e._wordTexts.push({text:t.text,isStuntFont:t.isStuntFont})}),e._splitFontWordTexts=[],this._splitFontWords.forEach(t=>{e._splitFontWordTexts.push({text:t.text,isStuntFont:t.isStuntFont})}),e._splitGroupWordTexts=[],this._splitGroupWords.forEach(t=>{e._splitGroupWordTexts.push({text:t.text,isStuntFont:t.isStuntFont})}),null!=this._dropingFontInfo&&(e._dropingFontInfoText={text:this._dropingFontInfo.text,isStuntFont:this._dropingFontInfo.isStuntFont}),null!=this._nextDropingFontInfo&&(e._nextDropingFontInfoText={text:this._nextDropingFontInfo.text,isStuntFont:this._nextDropingFontInfo.isStuntFont}),e._sysDispelFontInfoStackPoses=[],this._sysDispelFontInfoStack.forEach(n=>{e._sysDispelFontInfoStackPoses.push(new t.Point(n.x,n.y))}),e._sysDropingFontInfosPoses=[],this._sysDropingFontInfos.forEach(n=>{e._sysDropingFontInfosPoses.push(new t.Point(n.x,n.y))}),e._fontTexts=[];for(let t=0;t<this._fonts.length;t++){e._fontTexts[t]=[];for(let n=0;n<this._fonts[t].length;n++)null==this._fonts[t][n]?e._fontTexts[t][n]=null:e._fontTexts[t][n]={text:this._fonts[t][n].text,isStuntFont:this._fonts[t][n].isStuntFont}}localStorage.setItem("StorageVersion",s.version),localStorage.setItem("CacheData_1",JSON.stringify(e))}restoreAll(){if(this._debugMode)return!1;if(localStorage.getItem("StorageVersion")==s.version){let t=localStorage.getItem("CacheData_1");if(null==t)return!1;try{let e,n=JSON.parse(t);this._fonts=[];for(let t=0;t<this.list_grids.repeatX;t++){this._fonts[t]=[];for(let i=0;i<this.list_grids.repeatY;i++)null==n._fontTexts[t]||null==n._fontTexts[t][i]?this._fonts[t][i]=null:((e=this._fonts[t][i]=h.create({text:n._fontTexts[t][i].text})).isStuntFont=n._fontTexts[t][i].isStuntFont,e.x=t,e.y=i)}if(this._cacheProperties.forEach(t=>{this[t]=n[t]}),this._words=[],n._wordTexts.forEach(t=>{null!=(e=h.create({text:t.text})).text&&(e.isStuntFont=t.isStuntFont,this._words.push(e))}),this._splitFontWords=[],n._splitFontWordTexts.forEach(t=>{null!=(e=h.create({text:t.text})).text&&(e.isStuntFont=t.isStuntFont,this._splitFontWords.push(e))}),this._myPlayerInfo.wannengUseTimes=n.wannengUseTimes,this._myPlayerInfo.guideRemainTimes=n.guideRemainTimes,this._myPlayerInfo.guideUseTimes=n.guideUseTimes,this._myPlayerInfo.comeBackTimes=n.comeBackTimes,this._splitGroupWords=[],n._splitGroupWordTexts.forEach(t=>{null!=(e=h.create({text:t.text})).text&&(e.isStuntFont=t.isStuntFont,this._splitGroupWords.push(e))}),null!=n._dropingFontInfoText){if(this._dropingFontInfo=h.create({text:n._dropingFontInfoText.text}),null==this._dropingFontInfo.text)return!1;this._dropingFontInfo.isStuntFont=n._dropingFontInfoText.isStuntFont,this.setDispelText(this._dropingFontInfo.text),this._dropingFontInfo.x=this._startPoint.x,this._dropingFontInfo.y=this._startPoint.y}else this.randomNextFont(),this._dropingFontInfo=this._nextDropingFontInfo,this._nextDropingFontInfo=null;return null!=n._nextDropingFontInfoText&&(this._nextDropingFontInfo=h.create({text:n._nextDropingFontInfoText.text})),null==this._nextDropingFontInfo||null==this._nextDropingFontInfo.text?this.randomNextFont():this._nextDropingFontInfo.isStuntFont=n._nextDropingFontInfoText.isStuntFont,this._sysDispelFontInfoStack=[],n._sysDispelFontInfoStackPoses.forEach(t=>{null!=(e=this.getFontInfo(t.x,t.y))&&this._sysDispelFontInfoStack.push(e)}),this._sysDropingFontInfos=[],n._sysDropingFontInfosPoses.forEach(t=>{null!=(e=this.getFontInfo(t.x,t.y))&&this._sysDropingFontInfos.push(e)}),this._tickTime=(100-this._myPlayerInfo.getStarInfo(this._score).speed_rate)*this._maxTickTime/100,this.renderGridList(),this.refresh(),!0}catch(t){return localStorage.setItem("CacheData_1",null),!1}}return!1}moveDropingFont(t){if(null==this._dropingFontInfo)return;let e=.3*(100-this._myPlayerInfo.getStarInfo(this._score).speed_rate)*this._maxTickTime/100;t?this._dropingFontInfo.x>0&&null==this._fonts[this._dropingFontInfo.x-1][this._dropingFontInfo.y]&&(this.changeDropFontTo(this._dropingFontInfo.x-1,this._dropingFontInfo.y),this._tickTime=this._tickTime>e?this._tickTime:e):this._dropingFontInfo.x<this.list_grids.repeatX-1&&null==this._fonts[this._dropingFontInfo.x+1][this._dropingFontInfo.y]&&(this.changeDropFontTo(this._dropingFontInfo.x+1,this._dropingFontInfo.y),this._tickTime=this._tickTime>e?this._tickTime:e),this.renderGridList()}checkSysDropFonts(){for(let t=0;t<this.list_grids.repeatX;t++){let e=!1;for(let n=this.list_grids.repeatY-1;n>=0;n--)null!=this._fonts[t][n]&&(e||n+1<this.list_grids.repeatY&&null==this._fonts[t][n+1])&&(e=!0,-1==this._sysDropingFontInfos.indexOf(this._fonts[t][n])&&this._sysDropingFontInfos.push(this._fonts[t][n]))}}changeDropFontTo(t,e,n=null){e<0||t<0||t>=this.list_grids.repeatX||e>=this.list_grids.repeatY||(null==n&&(n=this._dropingFontInfo),this._fonts[n.x][n.y]=null,n.x=t,n.y=e,this._fonts[n.x][n.y]=n)}renderGridList(){let t=[];for(let e=0;e<this.list_grids.repeatY;e++)for(let n=0;n<this.list_grids.repeatX;n++)t.push(this._fonts[n][e]);this.list_grids.dataSource=t}dispelFont(t,e=0){let n,i,s;if(t instanceof h?(n=t,this._fonts[t.x][t.y]=null,i=t.x,s=t.y):(null!=(n=this.getFontInfo(t,e))&&(this._fonts[t][e]=null),i=t,s=e),null!=n){let t=this._sysDropingFontInfos.indexOf(n);-1!=t&&this._sysDropingFontInfos.splice(t,1),-1!=(t=this._sysDispelFontInfoStack.indexOf(n))&&this._sysDispelFontInfoStack.splice(t,1),n.destroyStuntEffect()}}invokeStuntFont(){let e,n,i=[],s=[],o=0,a={},r=function(e,n,i){null==a[e+"_"+n]&&(i.push(new t.Point(e,n)),a[e+"_"+n]=!0)};return this._stuntFontsCheckArr1.forEach(t=>{if(t.fontInfo==this.getFontInfo(t.fontInfo.x,t.fontInfo.y)){r(t.fontInfo.x-1,t.fontInfo.y,i),r(t.fontInfo.x+1,t.fontInfo.y,i),r(t.fontInfo.x,t.fontInfo.y-1,i),r(t.fontInfo.x,t.fontInfo.y+1,i);for(let n=0;n<this._fonts.length;n++)for(let i=0;i<this._fonts[n].length;i++)null!=(e=this._fonts[n][i])&&e.getStructInfos(t.id,!1).length>0&&(o+=10,r(e.x,e.y,s))}}),this._stuntFontsCheckArr2.forEach(t=>{for(let n=0;n<this._fonts.length;n++)for(let i=0;i<this._fonts[n].length;i++)null!=(e=this._fonts[n][i])&&e.getStructInfos(t.id,!1).length>0&&(o+=10,r(e.x,e.y,s))}),i.length>0&&(this.playEffectInc(),n=700,i.forEach(t=>{null!=(e=this.getFontInfo(t.x,t.y))&&(o+=10,this.dispelFont(e));let n=this.getFontScript(t.x,t.y);null!=n&&n.playHeChengEffect()}),t.Laya.timer.once(500,this,function(){i.forEach(t=>{let e=this.getFontScript(t.x,t.y);null!=e&&(e.font=null,e.clearEffects(),e.onUpdate())})}),t.Laya.timer.once(700,this,function(){this.renderGridList(),this.updateScore(),this.setStar(this._myPlayerInfo.getStarInfo(this._score).star_num)}),t.Laya.timer.once(850,this,function(){this.endEffectInc()})),s.length>0&&(this.playEffectInc(),n=1e3,t.Laya.timer.once(300,this,function(){s.forEach(t=>{null!=(e=this.getFontInfo(t.x,t.y))&&this.dispelFont(e);let n=this.getFontScript(t.x,t.y);null!=n&&n.playHeChengEffect()})}),t.Laya.timer.once(800,this,function(){s.forEach(t=>{let e=this.getFontScript(t.x,t.y);null!=e&&(e.font=null,e.clearEffects(),e.onUpdate())})}),t.Laya.timer.once(1150,this,function(){this.endEffectInc()})),this._score+=o,n>0&&t.Laya.timer.once(n,this,function(){this.renderGridList(),this.updateScore(),this.setStar(this._myPlayerInfo.getStarInfo(this._score).star_num)}),this._stuntFontsCheckArr1=[],this._stuntFontsCheckArr2=[],i.length>0||s.length>0}dispelCiZu(t){let e=[];for(let t=0;t<this.list_grids.repeatY;t++)for(let n=0;n<this.list_grids.repeatX;n++){let i=this.getFontInfo(n,t);if(null!=i){let t=i.text;-1==e.indexOf(t)&&e.push(t)}}let n=[];e.forEach(t=>{h.getGroup(t).forEach(t=>{if(-1!=n.indexOf(t))return;let i=t.split(""),s=!0;for(let t=0;t<i.length;t++)if(-1==e.indexOf(i[t])){s=!1;break}s&&(t==this._popularGroup?n.unshift(t):n.push(t))})});let i=!1;return t.forEach(t=>{if(this.getFontInfo(t.x,t.y)!=t)return;1==this.dispelCiZuItem(t.x,t.y,n)&&(i=!0)}),i}dispelCiZuItem(e,n,i){let s=this.getFontInfo(e,n);if(null!=s){for(let o=0;o<i.length;o++){let a=i[o];if(-1==a.indexOf(s.text))continue;this._checkChars=a.split("");let r=this.dispelCiZuItemSure(e,n,null);if(null!=r){I.playXiaoChuEffect(),this.playEffectInc(),a==this._popularGroup&&(this._popularGroup=null);let e=40,n=r.getSureList(),i=0,s={};return n.forEach(t=>{s[t.x+"_"+t.y]=!0,this.getFontScript(t.x,t.y).playHeChengEffect();let e=this.getFontInfo(t.x,t.y);null!=e&&(this.dispelFont(e),e.isStuntFont&&this._stuntFontsCheckArr2.push({fontInfo:e,id:e.id}),i++)}),n.forEach(t=>{let e=this.getFontInfo(t.x-1,t.y);null!=e&&(this.dispelFont(e),e.isStuntFont&&this._stuntFontsCheckArr2.push({fontInfo:e,id:e.id}),i++),null!=(e=this.getFontInfo(t.x+1,t.y))&&(this.dispelFont(e),e.isStuntFont&&this._stuntFontsCheckArr2.push({fontInfo:e,id:e.id}),i++),null!=(e=this.getFontInfo(t.x,t.y-1))&&(this.dispelFont(e),e.isStuntFont&&this._stuntFontsCheckArr2.push({fontInfo:e,id:e.id}),i++),null!=(e=this.getFontInfo(t.x,t.y+1))&&(this.dispelFont(e),e.isStuntFont&&this._stuntFontsCheckArr2.push({fontInfo:e,id:e.id}),i++)}),e+=10*i,this._score+=e,t.Laya.timer.once(500,this,function(){n.forEach(t=>{let e=this.getFontScript(t.x,t.y);e.font=null,e.clearEffects(),e.onUpdate()})}),t.Laya.timer.once(300,this,function(){n.forEach(t=>{let e,n=t.x-1,i=t.y;1!=s[n+"_"+i]&&null!=(e=this.getFontScript(n,i))&&e.playHeChengEffect(),n=t.x+1,i=t.y,1!=s[n+"_"+i]&&null!=(e=this.getFontScript(n,i))&&e.playHeChengEffect(),n=t.x,i=t.y-1,1!=s[n+"_"+i]&&null!=(e=this.getFontScript(n,i))&&e.playHeChengEffect(),n=t.x,i=t.y+1,1!=s[n+"_"+i]&&null!=(e=this.getFontScript(n,i))&&e.playHeChengEffect()})}),t.Laya.timer.once(1200,this,function(){this.setDispelText(a),this.renderGridList(),this.updateScore(),this.setStar(this._myPlayerInfo.getStarInfo(this._score).star_num)}),t.Laya.timer.once(2400,this,function(){this.endEffectInc()}),!0}}return!1}}dispelCiZuItemSure(t,e,n){let i=this.getFontInfo(t,e);if(null==i)return null;let s=null==n?this._checkChars.concat():n.chars.concat();if(-1==s.indexOf(i.text))return null;let o=new T;if(o.currentPoint.x=t,o.currentPoint.y=e,o.setOpenList(null==n?[]:n.getOpenList().concat()),o.setSureList(null==n?[]:n.getSureList().concat()),o.open(t,e,!1),o.sure(t,e),o.chars=s,o.chars.splice(o.chars.indexOf(i.text),1),0==o.chars.length)return o;o.isOpen(t-1,e)||o.isSure(t-1,e)||o.open(t-1,e),o.isOpen(t+1,e)||o.isSure(t+1,e)||o.open(t+1,e),o.isOpen(t,e-1)||o.isSure(t,e-1)||o.open(t,e-1),o.isOpen(t,e+1)||o.isSure(t,e+1)||o.open(t,e+1);let a=o.getOpenList();for(let t=0;t<a.length;t++){let e=a[t],n=this.dispelCiZuItemSure(e.x,e.y,o);if(null!=n)return n}return null}dispelStar(e,n){I.playXiaoChuEffect(),this.playEffectInc();let i=40,s=[{x:e,y:n}],o=0;s.concat();s.forEach(t=>{let e=this.getFontInfo(t.x-1,t.y),n=this.getFontScript(t.x-1,t.y);null!=e&&(this.dispelFont(e),n&&n.playHeChengEffect(),e.isStuntFont&&this._stuntFontsCheckArr2.push({fontInfo:e,id:e.id}),o++),e=this.getFontInfo(t.x+1,t.y),n=this.getFontScript(t.x+1,t.y),null!=e&&(this.dispelFont(e),n&&n.playHeChengEffect(),e.isStuntFont&&this._stuntFontsCheckArr2.push({fontInfo:e,id:e.id}),o++),e=this.getFontInfo(t.x,t.y-1),n=this.getFontScript(t.x,t.y-1),null!=e&&(this.dispelFont(e),n&&n.playHeChengEffect(),e.isStuntFont&&this._stuntFontsCheckArr2.push({fontInfo:e,id:e.id}),o++),e=this.getFontInfo(t.x,t.y+1),n=this.getFontScript(t.x,t.y+1),null!=e&&(this.dispelFont(e),n&&n.playHeChengEffect(),e.isStuntFont&&this._stuntFontsCheckArr2.push({fontInfo:e,id:e.id}),o++),e=this.getFontInfo(t.x-2,t.y),n=this.getFontScript(t.x-2,t.y),null!=e&&(this.dispelFont(e),n&&n.playHeChengEffect(),e.isStuntFont&&this._stuntFontsCheckArr2.push({fontInfo:e,id:e.id}),o++),e=this.getFontInfo(t.x+2,t.y),n=this.getFontScript(t.x+2,t.y),null!=e&&(this.dispelFont(e),n&&n.playHeChengEffect(),e.isStuntFont&&this._stuntFontsCheckArr2.push({fontInfo:e,id:e.id}),o++),e=this.getFontInfo(t.x,t.y-2),n=this.getFontScript(t.x,t.y-2),null!=e&&(this.dispelFont(e),n&&n.playHeChengEffect(),e.isStuntFont&&this._stuntFontsCheckArr2.push({fontInfo:e,id:e.id}),o++),e=this.getFontInfo(t.x,t.y+2),n=this.getFontScript(t.x,t.y+2),null!=e&&(this.dispelFont(e),n&&n.playHeChengEffect(),e.isStuntFont&&this._stuntFontsCheckArr2.push({fontInfo:e,id:e.id}),o++)}),i+=10*o,this._score+=i,t.Laya.timer.once(500,this,function(){s.forEach(t=>{let e=this.getFontScript(t.x,t.y);e.font=null,e.clearEffects(),e.onUpdate()})}),t.Laya.timer.once(200,this,function(){s.forEach(t=>{let e=this.getFontInfo(t.x,t.y),n=this.getFontScript(t.x,t.y);e&&this.dispelFont(e),n&&n.playHeChengEffect()})}),t.Laya.timer.once(1100,this,function(){this.setDispelText("*"),this.renderGridList(),this.updateScore(),this.setStar(this._myPlayerInfo.getStarInfo(this._score).star_num)}),t.Laya.timer.once(1400,this,function(){this.endEffectInc()})}dispel(t,e){let n=this.getFontInfo(t,e);if(null==n)return!1;if("*"==n.text)return this.dispelStar(t,e),!1;let i=n.canHeChengFontInfos;if(0==i.length)return!1;let s=this._popularGroup;null!=s&&i.sort(function(t,e){return-1!=s.indexOf(t.text)?-1:-1!=s.indexOf(e.text)?1:0});let o=!1;for(let t=0;t<i.length&&!o;t++){let e=i[t],s=e.structInfo.split(",");for(let t=0;t<s.length;t++){let i=s[t].split("_");if(i.length>1&&-1!=i.indexOf(n.id.toString())){if(this.dispelItem(n.x,n.y,i,e.id)){o=!0;break}}}}return o}dispelItem(e,n,i,s){if(null==this.getFontInfo(e,n))return;this._checkIds=i;let o=this.dispelItemSure(e,n,null);if(null!=o){I.playHeChengEffect(),this.playEffectInc();let i=0,a=o.getSureList();a.forEach(t=>{let e=this.getFontScript(t.x,t.y),n=this.getFontInfo(t.x,t.y);i<n.quality&&(i=n.quality),null!=e&&e.playHeChengEffect()});let r=h.create({id:s});this.setDispelText(r.text),r.x=e,r.y=n,r.quality=i+1;let l=this.getFontCell(e,n),d=new t.Point(l.x,l.y);t.Laya.timer.once(1410,this,function(i){i.forEach(i=>{let s=this.getFontInfo(i.x,i.y);if(null!=s){if(i.x!=e||i.y!=n){let e=this.getFontCell(i.x,i.y),n=this.getFontScript(i.x,i.y);n.font=null,n.clearEffects();let o=t.Pool.getItemByCreateFun("FontGrid",this.prefab_fontGrid.create,this.prefab_fontGrid);o.x=e.x,o.y=e.y;let a=o.getComponent(S);a.font=s.text,a.addEffect(s.getStuntFontEffect()),a.onUpdate(),this.list_grids.addChild(o),t.Tween.to(o,{x:d.x,y:d.y},100,null,t.Handler.create(this,function(t){t.destroy(!0)},[o]))}this.dispelFont(s),s&&s.isStuntFont&&this._stuntFontsCheckArr1.push({fontInfo:r,id:s.id})}})},[a]);let u=30;return u+=10*a.length,this._score+=u,c.getInstance(g).showLeftBottomTip("+"+u),t.Laya.timer.once(1500,this,function(){this._fonts[e][n]=r;let t=this.getFontScript(e,n);t.font=r.text,t.addEffect(r.getStuntFontEffect()),this.updateScore(),this.setStar(this._myPlayerInfo.getStarInfo(this._score).star_num)}),t.Laya.timer.once(2e3,this,function(){this.endEffectInc()}),this._sysDropingFontInfos.push(r),!0}return!1}dispelItemSure(t,e,n){let i=this.getFontInfo(t,e);if(null==i)return null;let s=null==n?this._checkIds.concat():n.chars.concat();if(-1==s.indexOf(i.id.toString()))return null;let o=new T;if(o.currentPoint.x=t,o.currentPoint.y=e,o.setOpenList(null==n?[]:n.getOpenList().concat()),o.setSureList(null==n?[]:n.getSureList().concat()),o.open(t,e,!1),o.sure(t,e),o.chars=s,o.chars.splice(o.chars.indexOf(i.id.toString()),1),0==o.chars.length)return o;o.isOpen(t-1,e)||o.isSure(t-1,e)||o.open(t-1,e),o.isOpen(t+1,e)||o.isSure(t+1,e)||o.open(t+1,e),o.isOpen(t,e-1)||o.isSure(t,e-1)||o.open(t,e-1),o.isOpen(t,e+1)||o.isSure(t,e+1)||o.open(t,e+1);let a=o.getOpenList();for(let t=0;t<a.length;t++){let e=a[t],n=this.dispelItemSure(e.x,e.y,o);if(null!=n)return n}return null}destroyGuideImgs(){for(let e in this._guideImgs){let n=this._guideImgs[e];t.Laya.timer.clearAll(n),t.Tween.clearAll(n),n.destroy(!0)}this._guideImgs={}}setNextGuideRate(){s.hadGuidance()?this._guideRate=Math.min(this._guideRate+1,6):this._score<300?this._guideRate=100:this._score<500?this._guideRate=40:this._score<800?this._guideRate=15:this._guideRate=Math.min(this._guideRate+1,6)}guideToGrid(){for(let e in this._guideImgs){let n=this._guideImgs[e];t.Laya.timer.clearAll(n),t.Tween.clearAll(n),n.destroy(!0)}if("*"==this._dropingFontInfo.text)return;this._guideImgs={};let e=100*Math.random();if(this._myPlayerInfo.guideRemainTimes>0&&(e=0),e>this._guideRate)return void this.setNextGuideRate();let n=this._dropingFontInfo.canHeChengFontInfos,i=this._dropingFontInfo.canHeChengGroups,s=this.getTopFontInfos(),o=[];s.forEach(e=>{null!=e.id&&(i.forEach(n=>{if(2!=n.length)return;let i=n.split("");i.splice(i.indexOf(this._dropingFontInfo.text),1),-1==i.indexOf(e.text)||o.push(new t.Point(e.x,e.y))}),n.forEach(n=>{let i=n.getStructInfos(e.id);for(let n=0;n<i.length;n++){let s=i[n].split("_");if(2==s.length&&(s.splice(s.indexOf(e.id.toString()),1),-1!=s.indexOf(this._dropingFontInfo.id.toString())))return void o.push(new t.Point(e.x,e.y))}}))}),o.length>0&&(this._guideRate=1,this.setNextGuideRate(),this._myPlayerInfo.guideRemainTimes>0&&this._myPlayerInfo.guideRemainTimes--,o.forEach(e=>{if(null!=this._guideImgs[e.x+"-"+e.y])return;let n=this.getFontCell(e.x,e.y),i=new t.Image("map/tz_jiantou.png");i.scaleX=i.scaleY=.7,i.rotation=90,i.x=75,i.y=-75,n.addChild(i),this._guideImgs[e.x+"-"+e.y]=i,t.Laya.timer.loop(1e3,i,function(e){let n=-75==e.y?-85:-75;t.Tween.to(e,{y:n},750)},[i])}))}getFontInfo(t,e){return null==this._fonts[t]?null:this._fonts[t][e]}getFontCell(t,e){return e<0||e>=this.list_grids.repeatY||t<0||t>=this.list_grids.repeatX?null:this.list_grids.getCell(e*this.list_grids.repeatX+t)}getFontScript(t,e){let n=this.getFontCell(t,e);return null==n?null:n.getComponent(S)}refresh(){this.setStar(this._myPlayerInfo.getStarInfo(this._score).star_num),this.updateNextDropingFont(),this.updateScore(),this.updatePopularGroup(),this._myPlayerInfo.wannengUseTimes>0?(this.btn_wanneng.mouseEnabled=!0,this.btn_wanneng.gray=!1):(this.btn_wanneng.mouseEnabled=!1,this.btn_wanneng.gray=!0),this._myPlayerInfo.guideUseTimes>0?(this.btn_point.mouseEnabled=!0,this.btn_point.gray=!1):(this.btn_point.mouseEnabled=!1,this.btn_point.gray=!0)}updateScore(){this.txt_score.text=this._score.toString()}updatePopularGroup(){if(null==this._popularGroup){let t=h.DataSource.bank;this._popularGroup=t[Math.floor(Math.random()*t.length)],this.heCiSplitTimes=0}null!=this._popularGroup&&(this.txt_popularGroup.text=this._popularGroup,this.img_popularGroupBg.height=this.txt_popularGroup.displayHeight+16)}updateNextDropingFont(){null==this._nextDropingFontInfo?this.txt_nextFont.text="":this.txt_nextFont.text=this._nextDropingFontInfo.text}setDispelText(e){switch(t.Tween.clearAll(this.mc_dispelText),this.mc_dispelText.scaleX=this.mc_dispelText.scaleY=.4,this.txt_dispelText.text=e,e.length){case 1:this.txt_dispelText.fontSize=120,this.txt_dispelText.size(120,120);break;case 2:this.txt_dispelText.fontSize=60,this.txt_dispelText.size(120,60);break;case 3:this.txt_dispelText.fontSize=40,this.txt_dispelText.size(120,40);break;case 4:this.txt_dispelText.fontSize=30,this.txt_dispelText.size(120,30)}t.Tween.to(this.mc_dispelText,{scaleX:1,scaleY:1},300)}setStar(t){let e=[];for(;t>0||e.length<5;)t>0?e.push(!0):e.push(!1),t--}reduceNanDu(t){return s.hadGuidance()||(this._score<300?t=Math.floor(250*t/100):this._score<500?t=Math.floor(160*t/100):this._score<700&&(t=Math.floor(130*t/100))),t}randomNextFont(){let e=this.getFontGridNum();if(e>25&&this.getRandomResult(30)&&(console.log(".....随机到了"),this.changeGameStatue(L.Pause),y.showInterstitialAd(t.Handler.create(this,this.onCPComple))),this._debugMode){let t=this._debugDropFonts.shift();if(this._nextDropingFontInfo=h.create({text:t}),null!=this._nextDropingFontInfo.text)return}if(100*Math.random()>this.buShouRate)this.buShouRate=Math.min(this.buShouRate+.3,3);else if(this._score>1500){this.buShouRate=0;let t=this.getRandomElement(h.DataSource.stunt_font);if(this._nextDropingFontInfo=h.create({text:t}),null!=this._nextDropingFontInfo.text)return void(this._nextDropingFontInfo.isStuntFont=!0)}if(void 0===this._myPlayerInfo.guideRemainTimes&&(this._myPlayerInfo.guideRemainTimes=0),this._guideDropFonts.length>0){let t=this._guideDropFonts.shift();if(this._nextDropingFontInfo=h.create({text:t}),null!=this._nextDropingFontInfo.text)return}if(!(this._myPlayerInfo.guideRemainTimes>0)&&this._splitFontWords.length>0&&(this._nextDropingFontInfo=this.getRandomElement(this._splitFontWords),this._splitFontWords.splice(this._splitFontWords.indexOf(this._nextDropingFontInfo),1),null!=this._nextDropingFontInfo))return;if(!(this._myPlayerInfo.guideRemainTimes>0)&&this._splitGroupWords.length>0&&(this._nextDropingFontInfo=this.getRandomElement(this._splitGroupWords),this._splitGroupWords.splice(this._splitGroupWords.indexOf(this._nextDropingFontInfo),1),null!=this._nextDropingFontInfo))return;let n=this.getNanDuXiShu(e)*this._myPlayerInfo.getStarInfo(this._score).split_rate,i=Math.min(100,Math.floor(this.heCizuRate*n/1e4));if(!(this._myPlayerInfo.guideRemainTimes>0)&&this.getRandomResult(i)&&(0==this._words.length&&(this.heCiSplitTimes++,this._words=this.splitGroupToFontInfos(this._popularGroup,null,this.heCiSplitTimes>2?"special":"commen")),this._nextDropingFontInfo=this.getRandomElement(this._words),this._words.splice(this._words.indexOf(this._nextDropingFontInfo),1),null!=this._nextDropingFontInfo))return e<6?(this.hanZiRate+=16,this.ciZuRate+=2):e<21?(this.hanZiRate+=10,this.ciZuRate+=2):e<28?(this.hanZiRate+=3,this.ciZuRate+=9):(this.hanZiRate+=2,this.ciZuRate+=10),void(this.heCizuRate=10);this.heCizuRate+=10;let s=this.getTopFontInfos();if(this._myPlayerInfo.guideRemainTimes>0&&(this.hanZiRate=1e4,this.ciZuRate=1e4),s.length>0){let t=this.getRandomElement(s);for(let e=0;e<5&&!t.canHeChengFont;e++)t=this.getRandomElement(s);if(t.canHeChengFont&&this.getRandomResult(this.reduceNanDu(this.hanZiRate*n/1e4))){let n=t.canHeChengFontInfos,i=this.getRandomElement(n);if(this._splitFontWords=this.splitFontToFontInfos(i,t.id),this._nextDropingFontInfo=this.getRandomElement(this._splitFontWords),this._splitFontWords.splice(this._splitFontWords.indexOf(this._nextDropingFontInfo),1),null!=this._nextDropingFontInfo)return this._myPlayerInfo.guideRemainTimes>0&&(this._dropingFontInfo=h.create({id:this._nextDropingFontInfo.id}),this._dropingFontInfo.isStuntFont=this._nextDropingFontInfo.isStuntFont),void(e<6?(this.hanZiRate=20,this.ciZuRate+=1):e<21?(this.hanZiRate=16,this.ciZuRate+=2):e<28?(this.hanZiRate=10,this.ciZuRate+=3):(this.hanZiRate=5,this.ciZuRate+=10))}for(let e=0;e<5&&!t.canHeChengGroup;e++)t=this.getRandomElement(s);if(t.canHeChengGroup&&this.getRandomResult(this.reduceNanDu(this.ciZuRate*n/1e4))){let n=t.canHeChengGroups,i=this.getRandomElement(n);if(this._splitGroupWords=this.splitGroupToFontInfos(i,t.text,"sp"),this._nextDropingFontInfo=this.getRandomElement(this._splitGroupWords),this._splitGroupWords.splice(this._splitGroupWords.indexOf(this._nextDropingFontInfo),1),null!=this._nextDropingFontInfo)return this._myPlayerInfo.guideRemainTimes>0&&(this._dropingFontInfo=h.create({id:this._nextDropingFontInfo.id}),this._dropingFontInfo.isStuntFont=this._nextDropingFontInfo.isStuntFont),void(e<6?(this.hanZiRate+=16,this.ciZuRate=4):e<21?(this.hanZiRate+=12,this.ciZuRate=5):e<28?(this.hanZiRate+=7,this.ciZuRate=14):e<35?(this.hanZiRate+=2,this.ciZuRate=16):(this.hanZiRate+=3,this.ciZuRate=18))}}e<6?(this.hanZiRate+=16,this.ciZuRate+=1):e<21?(this.hanZiRate+=11,this.ciZuRate+=2):e<30?(this.hanZiRate+=4,this.ciZuRate+=9):(this.hanZiRate+=2,this.ciZuRate+=10);let o=this.getRandHzBySocore(h.DataSource.font),a=h.create();a.setDataByValueArr(o),this._nextDropingFontInfo=a}getRandHzBySocore(t){if(0==t.length)return null;let e=100;return this._score>3e3&&this._score<=2e4?e+=(this._score-2e3)/15:this._score>2e4&&(e+=(this._score-2e3)/10),e>t.length&&(e=t.length-1-200),(e=Math.floor(Math.random()*e)+200)>t.length&&(e=t.length-1),t[e]}getTopFontInfos(){let t=[],e=null;for(let n=0;n<this.list_grids.repeatX;n++){e=null;for(let t=0;t<this.list_grids.repeatY;t++)if(null!=this._fonts[n][t]){e=this._fonts[n][t];break}null!=e&&t.push(e)}return t}splitGroupToFontInfos(t,e=null,n="commen"){let i=[];return t.split("").forEach(t=>{if(t==e)return;let s=h.create({text:t});null!=s.id?"commen"==n?i=i.concat(this.splitFontToFontInfos(s,null,n)):i.push(s):console.log("lack font:"+t)}),i}splitFontToFontInfos(t,e=null,n="commen"){let i;if(i=t instanceof h?t:h.create({text:t}),"commen"!=n)return[i];let s=[],o=i.structInfo.split(","),a=o[Math.floor(Math.random()*o.length)];return a==i.id.toString()?s.push(i):a.split("_").forEach(t=>{if(""==t||null!=e&&t==e.toString())return;let n=h.create({id:t});null!=n.id?s.push(n):console.log("lack font id:"+t)}),s}getRandomResult(t){return Math.floor(100*Math.random())<t}getNanDuXiShu(t){return h.DataSource.degree_difficulty[t]}getFontGridNum(){let t=0;for(let e=0;e<this.list_grids.repeatX;e++)for(let n=0;n<this.list_grids.repeatY;n++)if(null!=this._fonts[e][n]){t+=this.list_grids.repeatY-n;break}return t}getRandomElement(t){return 0==t.length?null:t[Math.floor(Math.random()*t.length)]}playEffectInc(){this._playerEffectInd++,this.changeGameStatue(L.EffectPause)}endEffectInc(){this._playerEffectInd--,this._playerEffectInd<0&&(this._playerEffectInd=0),0==this._playerEffectInd&&this._gameState==L.EffectPause&&(this.changeGameStatue(L.Playing),this.checkSysDropFonts(),this._sysDispelFontInfoStack=[],0==this._sysDropingFontInfos.length&&this.invokeStuntFont())}}class T{constructor(){this.currentPoint=new t.Point,this._openList=[],this._openObj={},this._sureList=[],this._sureObj={}}setOpenList(t){t.forEach(t=>{this.open(t.x,t.y)})}getOpenList(){return this._openList}setSureList(t){t.forEach(t=>{this.sure(t.x,t.y)})}getSureList(){return this._sureList}open(e,n,i=!0){let s=e.toString()+"_"+n.toString();if(i){let i=new t.Point(e,n);this._openList.push(i),this._openObj[s]=i}else null!=this._openObj[s]&&(this._openList.splice(this._openList.indexOf(this._openObj[s]),1),delete this._openObj[s])}isOpen(t,e){let n=t.toString()+"_"+e.toString();return null!=this._openObj[n]}sure(e,n){let i=e.toString()+"_"+n.toString(),s=new t.Point(e,n);this._sureList.push(s),this._sureObj[i]=s}isSure(t,e){let n=t.toString()+"_"+e.toString();return null!=this._sureObj[n]}}class D extends t.Button{constructor(){super(),this.scaleNum=.8,this.oldScaleX=1,this.oldScaleY=1,this.on(t.Event.MOUSE_DOWN,this,this.btnDown)}btnUp(){t.Tween.to(this,{scaleX:this.oldScaleX,scaleY:this.oldScaleY},100,null,t.Handler.create(this,this.upComplete))}upComplete(){this.isOnTween=!1}btnDown(){this.isOnTween||(this.oldScaleX=this.scaleX,this.oldScaleY=this.scaleY,this.isOnTween=!0,t.Tween.to(this,{scaleX:this.oldScaleX*this.scaleNum,scaleY:this.oldScaleY*this.scaleNum},100,null,t.Handler.create(this,this.downComplete)))}downComplete(){this.btnUp()}}var R,P=t.ClassUtils.regClass;!function(e){!function(e){e.LoadingUI=class extends t.Scene{constructor(){super(),this.referenceClass=[t.Image,t.Label]}}}(e.loading||(e.loading={}))}(R||(R={})),function(e){!function(e){e.MainGameUI=class extends t.Scene{constructor(){super(),this.referenceClass=[t.Image,t.Box,t.Text,t.Sprite,t.Button,t.Label,t.List]}}}(e.main||(e.main={}))}(R||(R={})),function(e){!function(e){class n extends t.Scene{constructor(){super(),this.referenceClass=[t.Label,t.Sprite]}createChildren(){super.createChildren(),this.loadScene("test/TestScene")}}e.TestSceneUI=n,P("ui.test.TestSceneUI",n)}(e.test||(e.test={}))}(R||(R={}));class A extends Laya.Script{constructor(){super(),this.createBoxInterval=1e3,this._time=0,this._started=!1}onEnable(){this._time=Date.now(),this._gameBox=this.owner.getChildByName("gameBox")}onUpdate(){let t=Date.now();t-this._time>this.createBoxInterval&&this._started&&(this._time=t,this.createBox())}createBox(){let t=Laya.Pool.getItemByCreateFun("dropBox",this.dropBox.create,this.dropBox);t.pos(Math.random()*(Laya.stage.width-100),-100),this._gameBox.addChild(t)}onStageClick(t){t.stopPropagation();let e=Laya.Pool.getItemByCreateFun("bullet",this.bullet.create,this.bullet);e.pos(Laya.stage.mouseX,Laya.stage.mouseY),this._gameBox.addChild(e)}startGame(){this._started||(this._started=!0,this.enabled=!0)}stopGame(){this._started=!1,this.enabled=!1,this.createBoxInterval=1e3,this._gameBox.removeChildren()}}class G extends R.test.TestSceneUI{constructor(){super(),G.instance=this,Laya.MouseManager.multiTouchEnabled=!1}onEnable(){this._control=this.getComponent(A),this.tipLbll.on(Laya.Event.CLICK,this,this.onTipClick)}onTipClick(t){this.tipLbll.visible=!1,this._score=0,this.scoreLbl.text="",this._control.startGame()}addScore(t=1){this._score+=t,this.scoreLbl.changeText("分数："+this._score),this._control.createBoxInterval>600&&this._score%20==0&&(this._control.createBoxInterval-=20)}stopGame(){this.tipLbll.visible=!0,this.tipLbll.text="游戏结束了，点击屏幕重新开始",this._control.stopGame()}}class v{constructor(){}static init(){var e=t.ClassUtils.regClass;e("ui",R),e("script/scene/LoadingScene.ts",a),e("script/scene/MainGameScene.ts",E),e("script/tool/ButtonRunTime.ts",D),e("script/prefeb/FontGrid.ts",S),e("script/GameUI.ts",G),e("script/GameControl.ts",A),e("script/prefeb/GameResult.ts",x),e("script/prefeb/GameSetting.ts",b),e("script/prefeb/StartGame.ts",w),e("script/prefeb/TipItem.ts",p),e("Laya.Text",t.Text),e("Laya.BoxCollider",t.BoxCollider),e("Laya.RigidBody",t.RigidBody)}}v.width=640,v.height=1136,v.scaleMode="showall",v.screenMode="vertical",v.alignV="middle",v.alignH="center",v.startScene="loading/Loading.scene",v.sceneRoot="",v.debug=!1,v.stat=!1,v.physicsDebug=!1,v.exportSceneToJson=!0,v.init();new class{constructor(){let e=s.getMobileHeight();window.Laya3D?window.Laya3D.init(v.width,e):t.Laya.init(v.width,e,t.WebGL),t.Laya.DebugPanel&&t.Laya.DebugPanel.enable(),"wx"==s.platform?(t.Laya.stage.scaleMode="fixheight",t.Laya.URL.basePath="https://raw.githubusercontent.com/wupei1987/font-game-wx-asset/master/",window.Laya.MiniAdpter.nativefiles=["btn_startGame.png","fileconfig.json","version.json","loading/Loading.json","res/atlas/loading.atlas","res/atlas/loading.png","main/MainGame.json","res/atlas/map.atlas","res/atlas/map.png","res/data.json","res/spine/other_taozhuangxitong1.sk","res/spine/other_taozhuangxitong1.png","res/spine/other_wupinghuanrao_kin_little.sk","res/spine/other_wupinghuanrao_kin_little.png"],t.ResourceVersion.enable("version.json",t.Handler.create(this,this.onVersionLoaded),t.ResourceVersion.FILENAME_VERSION)):t.Laya.stage.scaleMode=v.scaleMode,t.Laya.stage.scaleMode=v.scaleMode,t.Laya.stage.screenMode=v.screenMode,t.Laya.stage.alignV=v.alignV,t.Laya.stage.alignH=v.alignH,t.URL.exportSceneToJson=v.exportSceneToJson,(v.debug||"true"==t.Utils.getQueryString("debug"))&&t.Laya.enableDebugPanel(),v.physicsDebug&&t.PhysicsDebugDraw.enable(),v.stat&&t.Stat.show(),t.Laya.alertGlobalError(!0),t.ResourceVersion.enable("version.json",t.Handler.create(this,this.onVersionLoaded),t.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){t.AtlasInfoManager.enable("fileconfig.json",t.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){t.Scene.open(v.startScene,!0,null,t.Laya.Handler.create(this,this.onLoadingLoad))}updateLoadingProgress(t){t=Math.floor(t),null!=n.curSceneScript&&n.curSceneScript instanceof a&&n.curSceneScript.updatePercent(t)}onLoadingLoad(){t.Laya.Browser.window.loadingView&&t.Laya.Browser.window.loadingView.hideLoadingView(),this.updateLoadingProgress(0),l.Instance().loadList(s.getInitLoadingUrls(),this,function(t,e){this.updateLoadingProgress(t/e*90)},function(){this.loadStartScene()})}loadStartScene(){let e=t.Laya.loader.getRes("res/data.json");h.DataSource=e,t.Scene.open("main/MainGame.scene",!0,null,t.Laya.Handler.create(this,this.onGameStart),t.Laya.Handler.create(this,this.onGameLoadProgress,[],!1)),t.Laya.Browser.onMiniGame&&window.Laya.MiniAdpter.sendAtlasToOpenDataContext("res/atlas/test.atlas"),l.Instance().loadList(s.getAsynUrls(),this,function(t,e){},function(){s.asynUrlsLoaded=!0})}onGameLoadProgress(e){t.Laya.Browser.window.loadingView&&t.Laya.Browser.window.loadingView.loading(100*e),this.updateLoadingProgress(90+10*e)}onGameStart(){"tt"==s.platform&&F.init(),c.getInstance(g).init(),I.init()}}}(Laya);
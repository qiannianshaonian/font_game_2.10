"use strict";var _interopRequireDefault=require("@babel/runtime-corejs2/helpers/interopRequireDefault"),_Object$defineProperty=require("@babel/runtime-corejs2/core-js/object/define-property");_Object$defineProperty(exports,"__esModule",{value:!0}),exports.logger=logger;var _path=_interopRequireDefault(require("path")),_cliSharedUtils=require("@vivo-minigame/cli-shared-utils"),_recordClient=require("./record-client.js");/**
 * 记录最新的用户进入的请求
 */async function logger(a,b){try{const{sn:c,clientIp:d,linkMode:e,serverIp:f}=(0,_recordClient.getClientFromRequest)(a.request),g=d;let h={sn:c,ip:g,port:_recordClient.CLIENT_PORT};switch(e){case _recordClient.LINK_MODE.WIFI:console.info(`### App Server ### 记录从${g}进入的HTTP请求`),(0,_recordClient.recordClient)(_recordClient.clientRecordPath,h);break;case _recordClient.LINK_MODE.ADB:if(h=(0,_recordClient.getRecordClient)(_recordClient.clientRecordPath,c,g),!h){const b=a.adbDebugger.emulators.get(c);console.warn(`### App Server ### 通过（${c}）查找到设备${b}`),h=(0,_recordClient.getRecordClient)(_recordClient.clientRecordPath,b,d)}h?(console.info(`### App Server ### 记录从设备(${c})进入的HTTP请求`),(0,_recordClient.recordClient)(_recordClient.clientRecordPath,h)):console.warn(`### App Server ### ：记录设备(${c})失败`);}0>a.href.indexOf("inspector")&&(0,_cliSharedUtils.info)(`### App Server ### 记录从${g}进入的HTTP请求`),g!==f&&_cliSharedUtils.fs.outputJsonSync(_path.default.resolve(__dirname,"client.json"),{client:g,timestamp:new Date}),await b()}catch(a){(0,_cliSharedUtils.error)(`### App Server ### 记录log出错: ${a.message}`)}}